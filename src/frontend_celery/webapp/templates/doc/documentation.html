{% extends 'base.html' %}


{% block content %}

<div class="container">

  
<h1> {% block title %} Welcome to the HerediVar Wiki {% endblock %} </h1>




<div class="row p-relative">
    <div class="col-3 p-fixed width_medium" id="nav_container">
      <nav id="navbar-example3" class="h-100 flex-column align-items-stretch pe-4 border-end ">
        <nav class="nav nav-pills flex-column">
          <a class="nav-link" href="#item-0">General Thoughts</a>
          <a class="nav-link" href="#item-1">The workflow</a>
          <nav class="nav nav-pills flex-column">
            <a class="nav-link ms-3 my-1" href="#item-1-1">Insert variants</a>
            <a class="nav-link ms-3 my-1" href="#item-1-2">Browse variants</a>
            <a class="nav-link ms-3 my-1" href="#item-1-3">Variant details page</a>
            <a class="nav-link ms-3 my-1" href="#item-1-4">Classify a variant</a>
          </nav>
          <a class="nav-link" href="#item-2">User variant lists</a>
          <a class="nav-link" href="#item-svs">Structural variants</a>
          <a class="nav-link" href="#item-download">Download data</a>
          <a class="nav-link" href="#item-3">User management</a>
          <nav class="nav nav-pills flex-column">
            <a class="nav-link ms-3 my-1" href="#item-3-1">Create a new user</a>
            <a class="nav-link ms-3 my-1" href="#item-3-2">Change roles & disable users</a>
            <a class="nav-link ms-3 my-1" href="#item-3-3">Change password</a>
          </nav>
        </nav>
      </nav>
    </div>
  
    <div class="col-8 vbsl">
      <div data-bs-spy="scroll" data-bs-target="#navbar-example3" data-bs-smooth-scroll="true" class="scrollspy-example-2" tabindex="0">

        <div id="item-0">
          <h4>General Thoughts & Conventions</h4>
          <p>
            There are four types of users in HerediVar:
            <ol>
                <li>Superuser</li>
                <li>Standard user</li>
                <li>Read only user</li>
                <li>Anonymous user</li>
                <li>Account manager</li>
            </ol>
            An anonymous user can not view or edit any variant information on HerediVar. Anonymous users must ask an account manager to create an account for them. 
            As the name implies, the read only user can only view information. He can neither insert variants nor classify them. 
            The standard user is allwed to view and edit information on HerediVar and the superuser has access to the admin dashboard
            which allows him to import variants from HerediCare, reannotate all variants at once and do multiple other administrative tasks. <br>
            The account manager is a special role which allows the user to create and modify user data. <br>
            <br>
            Conventions for links: It is very easy to differentiate external links from internal ones: Whenever a link is displayed like {{ macros.external_link('this', '#') }} 
            it references an external website and if a link is shown like <a href="#">this</a> it references an internal page. <br>
            <br>
            It is very important to understand that each user is able to insert one classification for each variant - classification scheme combination. In addition,
            a superuser can insert one consensus classification for each variant. Consensus classifications are always superseded by the newest consensus classification.
          </p>
        </div>


        <div id="item-1">
          <h4>The workflow</h4>
          <p></p>
        </div>
        <div id="item-1-1">
          <h5>Insert variants</h5>
          <p>
            There are two ways to insert small variants. The most common one is to import variants from HerediCare. However, only superusers can do that. Standard users can 
            insert variants through the <a href="{{ url_for('variant.create')}}">create variant page</a> for small variants. New variants are automatically added to the annotation queue
            and processed once a worker is ready to process it. The status of the annotation can be seen when navigating to the variant details page. <br>
            <br>
            HerediVar also supports structural variants, however, in a limited manner. Thus, it is currently only possible to insert deletions, duplications and inversions.
            These must be inserted manually through the <a href="{{ url_for('variant.create_sv') }}"> create structural variant page</a>. Although they generally behave identical compared
            to a small variant, they are currently not annotated with meta information.
          </p>
        </div>
        <div id="item-1-2">
          <h5>Browse variants</h5>
          <p>
            To find the variant you are looking for navigate to the <a href="{{url_for('variant.search')}}">search variants page</a>. This page shows a paginated 
            table of all variants. Note that the HGVS c. and HGVS p. columns are dependent on the transcript. Thus, these two columns show the HGVS strings of the 
            preferred transcript (MANE -> longest coding -> longest non coding). If the variant is contained within more than one gene all of the HGVS strings from 
            the preferred transcripts of all genes are shown. The "Your classification" shows the most recent user classification of the current user. <br>
            To filter the table of all variants click the magnifiying glass to the top right. The search is explained in more detail <a href="{{url_for('doc.search_help')}}">here</a> <br>
            It is also possible to add all variants which satisfy the current filtering criteria to a user defined list by clicking the "Add to list" button located at 
            the bottom left. To create a new list go <a href="{{url_for('user.my_lists')}}">here</a>. <br>
            Clicking on any of the rows will get you to its variant details page. To view details about a particular gene just click its name. 
          </p>
        </div>
        <div id="item-1-3">
          <h5>The variant details page</h5>
          <p>
            This page displays all annotations of a variant. The top headline shows the variant and its most recent consensus classification by the VUS task-force. There are multiple types of
            consensus classifications:
            <div class="d-flex">
              {% for classification in ['-', '1', '2', '3-', '3', '3+', '4M', '4', '5'] %}
              <div class="ssr">{{macros.render_consensus_classification_label(classification, 'heredivar') }}</div>
              {% endfor %}
            </div>
            These are interpreted as follows:
            <ul>
              <li>-: no classification</li>
              <li>1: benign</li>
              <li>2: likely benign</li>
              <li>3-: uncertain with tendency to benign</li>
              <li>3: uncertain</li>
              <li>3+: uncertain with tendency to pathogenic</li>
              <li>4: likely pathogenic</li>
              <li>4M: modifier</li>
              <li>5: pathogenic</li>
            </ul>
            If the consensus classification symbol shows a red download icon like so:
            <div class="d-flex">
              <div class="ssr">{{macros.render_consensus_classification_label('2', 'heredicare') }}</div>
            </div>
            It means that the consensus classification was imported from HerediCare and there is no consensus classification available for this variant which was made on HerediVar. <br>
            <div class="bsb"></div>
            Right below the headline one can find status information about the variant. The first pill shows the status of the annotation. It could be queued, processing, done or erroneous.
            Next to the annotation status pill there is the clinvar submission status. This shows if the variant was already uploaded to ClinVar from HerediVar. There is one additional, optional 
            status pill which sais "HIDDEN" if the variant is hidden. When you click the "gear" button
            the website presents options on what to do with the variant. <br>
            The main body of the page displays visualizations, classifications and annotations which are organized in multiple tabs. The tabs contain the following information:
            <ul>
              <li>Classification: HerediVar consensus classification, HerediVar user classifications, HerediCare center classifications, ClinVar classifications, BRCA exchange and ARUP BRCA classifications</li>
              <li>Population & in-silico annotations: phylop-100way, cadd scaled, revel, spliceai, maxentscan, gnomAD, flossies, cancerhotspots, tp53db, hexplorer, maxhbond score</li>
              <li>Consequence: The variant consequences with associated HGVS strings and protein domains</li>
              <li>Assays: Functional, splicing, etc. assays. Add a new assay by clicking the gear button at the top.</li>
              <li>Literature: Papers annotated by VEP, TP53db and litvar2</li>
              <li>
                IGV: The IGV genome browser. The first track shows the variant itself. The second and third track show all classified variants (click on them to find a link to the variant details page). The fourth track
                shows the ensembl transcripts. Red transcripts are MANE select or MANE plus clinical transcripts, orange ones are ensembl canonical and dark blue ones are gencode basic transcripts. Other transcripts
                which do not satisfy the aforementioned criteria are not shown.
              </li>
            </ul>
            Remember that annotations are not shown if the variant is unknown to the respective database. 
          </p>
        </div>
        <div id="item-1-4">
          <h5>Classify a variant</h5>
          <p>
            To classify a variant click the gear button and select "Classify". On the classify variant page you can first select if you want to insert a user classification or a consensus classification.
            However, only superusers can insert consensus classifications. Next, select the classification scheme or no scheme if you just want to insert a freetext classification not following a scheme.
            The webpage automatically chooses the best scheme for the variant if possible. <br>
            Click a criteria button to see more details about it. Here is an example for PVS1:
            <div>
              <img src="/static/img/documentation/classify_01.PNG" alt="missing img"  width="100%">
            </div>
            First, insert evidence and then click the checkbox next to the headline of the variant to select the criterium. It is also possible to adjust the strength of some criteria. The classification
            preview to the right will update automatically based on the selected criteria. <br>
            Once all criteria have been selected you can insert further evidence by adding literature passages. Simply add a blank row or add one from the text mining results and fill the text passage
            of interest. <br>
            Finally, select the final classification and leave a comment possibly referencing literature to complete the classification. <br>
            Note that each user can only have one user classification per variant and scheme, but they can be edited anytime. <br>
            Consensus classifications work just alike. The only difference is that the number of users who chose that criterium is displayed next to it like so:
            <div>
              <img src="/static/img/documentation/classify_02.PNG" alt="missing img"  width="100%">
            </div>
            The selected criterium, "PS1" was chosen by two HerediVar users to be important for this variant. The actual user input is shown in the "User selections" table. When you click the copy symbol
            it is possible to quickly copy this users selection and evidence. Then, simply select the criterium using the dropdown menu next to the criterium name.
          </p>
        </div>


        <div id="item-2">
          <h4>User variant lists</h4>
          <p>
            Each registered user can add new variant lists <a href="{{url_for('user.my_lists')}}">here</a>. Click the "+" button:
            <div>
              <img src="/static/img/documentation/variant_list_01.PNG" alt="missing img"  width="100%">
            </div>
            Enter a name for the list and select if it is readable / editable by all HerediVar users. If a list is readable everyone can see the list, but they can not add or remove variants from it.
            This is however possible when the list is also editable. <br>
            There are two ways to insert variants to the newly created variant list. The first one is to add variants to a list on a one-by-one basis is to navigate to the variant details page, 
            click the gear button and select "Add to list". <br>
            The second one is to visit the <a href="{{url_for('variant.search')}}">browse variants</a> page. You can simply select the variants that you wish to save to a list and select "Add selected to list".
            To simplify things one can also choose to select and unselect all variants. Keep in mind that only variants which satisfy the current search parameters are added when select all variants is active.
            The page also keeps track of selected variants through pages of the variant table. So it is save to first select all variants and then click the "Add selected to list" button once. Keep in mind though
            that your selection will reset upon querying a new search. <br>
            <br>
            All variants collected in these ways are displayed when clicked on the name of the list at the <a href="{{url_for('user.my_lists')}}">user lists page</a>. 
            The table of variants behaves exactly the same as the one shown on the <a href="{{url_for('variant.search')}}">browse variants</a> page. It can be filtered and when a row is clicked
            it takes you to the variant details page.<br>
            It is also possible to export all variants in one of the lists to vcf by clicking the "Export to VCF" button on the bottom of the page. <br>
            If you want to change the properties or delete a list that was created by you. Just click the little pencil button next to the list name. Beware that private lists can not be seen
            by other HerediVar users. <br>
            <br>
            To further simplify handling these lists there are four possible actions to manipulate variant lists. First click the list you wish to edit. Then, you can see four icon-buttons on the top
            which are explained as follows:
            <ul>
              <li>{{ macros.draw_duplicate_symbol() }}: duplicate the list</li>
              <li>{{ macros.draw_intersect_symbol() }}: intersect this list with another list</li>
              <li>{{ macros.draw_subtract_symbol() }}: subtract another list from this list</li>
              <li>{{ macros.draw_add_symbol() }}: combine this list with another list</li>
            </ul>
            As you can see, these implement simple set operations. The website will ask some more questions about how to do each of the operations. For example, some operations allow you to do it either inplace or or not in place.
            When you choose inplace it will take the result of the operation and write it to the currently selected list. When this is not selected it will create a new list (asking you to 
            choose a new name and access rights).
          </p>
        </div>
        
        
        <div id="item-svs">
          <h4>Structural variants</h4>
          <p>
            Structural variants can only be inserted using the <a href="{{ url_for('variant.create_sv') }}">create structural variants page</a>. They generally behave identical to a small variant, but are not annotated by
            the annotation service. Also, the interpretation of the information in the browse variants table differs slightly:
            <div>
              <img src="/static/img/documentation/structural_variants_01.PNG" alt="missing img"  width="100%">
            </div>
            The differences are:
            <ul>
              <li>If a deletion is longer than 1000 bp, the POS column contains the start and end position of the structural variant separated by a dash (-). 
                The sequence of duplications and inversions is never displayed, independent of the length of the variant.</li>
              <li>The POS column will show a red triangle if the position is imprecise</li>
              <li>The HGVS c. and p. columns contain the hgvs strings that were provided by the user upon creation of the variant. They are not ordered in any way nor are they curated or correspond to the genes shown in the gene column</li>
              <li>The GENE column shows only genes that overlap the breakpoints of the structural variants</li>
            </ul>
            The variant details page of structural variants is also similar to that of small variants with the only difference being that the variant banner at the top shows all genes that overlap the region of the structural variant.
            These are color coded:
            <ul>
              <li>blue: gene overlaps breakpoint</li>
              <li>bold: VUS-Task-Force important gene</li>
              <li>black: non breakpoint overlapping gene</li>
            </ul>
          </p>
        </div>


        <div id="item-download">
          <h4>Download data</h4>
          <p>
            Anonymous users can download all classified variants and all classified structural variants in vcf <a href="{{ url_for('main.downloads') }}">here</a>. They will only see the consensus classifications by the VUS-task-force along
            with some meta information. Most of this data is also publically available through ClinVar. <br>
            <br>
            Registered users are able to download a vcf file for one variant through the respective variant details page by clicking the gear button and selecting "Export to VCF". This file will contain all information that are available
            for this variant. Including all annotations and classifications. <br>
            <br>
            If a registered user wants to download more than one variant in a single file they have to collect relevant variants in a user defined list (see previous section on how to create one). Then, simply click the "Export list to VCF"
            button at the bottom right of the list details page.  Note that structural variants and small variants can be mixed in this case. <br>
            <br>
            In rare cases ClinVar submissions are missing although there is a ClinVar summary available. In such cases the clinvar_submissions info in the downloaded vcf file will be set to None. This is usually because of erroneous data hosted
            by ClinVar and is often fixed by updating ClinVar.<br>
            <br>
            In any case, downloaded VCF files are encoded using the url encoding (<a href="https://en.wikipedia.org/wiki/Percent-encoding">Wikipedia</a>). Excluding whitespace, which is replaced with underscores "_". This ensures that the
            file is machine readable and consistent when special characters that are also used as delimiters are used within the actual information. It is fast forward to revert the encoding once relevant information was read from the file.
            Many programming languages support url decoding out of the box.<br>
            <br>
            The downloaded VCF files from HerediVar always adhere to this delimiter order:
            <ol>
              <li>;</li>
              <li>&</li>
              <li>|</li>
              <li>$</li>
              <li>+</li>
            </ol>
          </p>
        </div>


        <div id="item-3">
          <h4>User management</h4>
          <p></p>
        </div>
        <div id="item-3-1">
          <h5>Create a new user</h5>
          <p>
            Only users with the "account_manager" role are allowed to create new users. There is no possibility to self-register in HerediVar.
            An account manager can go <a href="{{ url_for('auth.register') }}">here</a> to create a new user account. Simply fill out the form which is presented 
            to you. Keep in mind that the username must be unique and can not be changed later. The mail address must be unique as well.<br>
            Upon submission Heredivar will automatically notify the user that about the newly created account using the provided e-mail. The new user will 
            recieve two mails: one with the username specified and one with an automatically generated initial password.
          </p>
        </div>
        <div id="item-3-2">
          <h5>Change roles & disable users</h5>
          <p>
            An account manager can edit existing users by visiting <a href="{{url_for('auth.show_users')}}">{{url_for('auth.show_users')}}</a>. Simply select a user from the list
            to edit its information. It is possible to disable users or change their roles from this page. <br>
            Keep in mind that changeing the e-mail will require the user to verify the mail upon next login.
          </p>
        </div>
        <div id="item-3-2">
          <h5>Change password</h5>
          <p>
            Every user can change their own password by visiting <a href="{{url_for('auth.change_password')}}">this</a> page. This will redirect to the keycloak account management
            console. First click the Update-button:
            <div>
              <img src="/static/img/documentation/change_password.PNG" alt="missing img"  width="100%">
            </div>
            Then, you are probably asked to re-authenticate using your old password. After that you can insert a new password.
          </p>
        </div>


      </div>
    </div>
  </div>
  





{% endblock %}

{% block special_scripts %}
<script src="/static/js/documentation.js"></script>
{% endblock %}