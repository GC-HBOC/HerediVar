

{% extends 'base.html' %}


{% block content %}





<div class="sst ssb">
    
    <div class="d-flex align-items-center">
        <div class="flex-grow-1">
            <!-- title -->
            <h1>
                <div id="variant_page_title" style="word-break:break-all; width:95%;" chrom="{{ variant[1] }}" pos="{{ variant[2] }}" ref="{{ variant[3] }}" alt="{{ variant[4] }}">
                    : {% block title %} {{ variant[1] }}-{{ variant[2] }}-{{ variant[3] }}-{{ variant[4] }} {% endblock %}(GRCh38)
                </div>
            </h1>

            <!-- save some data for js -->
            <meta id="variant_id_container" data-variant-id="{{ variant[0] }}">
            <meta id="annotation_status" data-annotation-status="{{ current_annotation_status[4] }}" data-celery-task-id="{{ current_annotation_status[7] }}">


            <div class="d-flex align-items-center">
                <!-- status badges -->
                <div id="annotation_status_pills">
                    {% if current_annotation_status is not none %}

                        {% if current_annotation_status[4] == 'pending' %}
                            <span class="badge rounded-pill bg-secondary" data-bs-toggle="tooltip" title="Annotation requested at {{ current_annotation_status[3] }}">Annotation requested, <br> refresh page to see if it is ready</span>
                        {% endif %}
                        {% if current_annotation_status[4] == 'success' %}
                            <span class="badge rounded-pill bg-success" data-bs-toggle="tooltip" title="Most recent annotation finished at {{ current_annotation_status[5] }}">Annotation done</span>
                        {% endif %}
                        {% if current_annotation_status[4] == 'error' %}
                            <span class="badge rounded-pill bg-danger" data-bs-toggle="tooltip" title="Most recent annotation finished at {{ current_annotation_status[5] }} with fatal error {{ current_annotation_status[6] }}">Annotation error</span>
                        {% endif %}
                        {% if current_annotation_status[4] == 'retry' %}
                            <span class="badge rounded-pill bg-warning" data-bs-toggle="tooltip" title="Most recent annotation yielded an error: {{ current_annotation_status[6] }}. Retrying soon.">Retrying annotation</span>
                        {% endif %}

                    {% else %}
                        <span class="badge rounded-pill bg-secondary" data-bs-toggle="tooltip" title="This variant was not annotated, yet.">No annotation</span>
                    {% endif %}
                </div>
                <div class="ssl"> 
                    {% set status = clinvar_submission['status'] %}
                    {% if status in ['processed'] %}
                        <span class="badge rounded-pill bg-success" data-bs-toggle="tooltip" title="Most recent ClinVar submission finished at {{ clinvar_submission['date'] }}">ClinVar success</span>
                    {% endif %}
                    {% if status in ['error'] %}
                        <span class="badge rounded-pill bg-danger" data-bs-toggle="tooltip" title="Most recent ClinVar submission yielded an error at {{ clinvar_submission['date'] }} with error message: {{ clinvar_submission['message'] }}">ClinVar error</span>
                    {% endif %}
                    {% if status in ['submitted', 'processing'] %}
                        <span class="badge rounded-pill bg-secondary" data-bs-toggle="tooltip" title="Most recent ClinVar submission last updated at {{ clinvar_submission['date'] }}">ClinVar {{ status }}</span>
                    {% endif %}
                    {% if status is none %}
                        <span class="badge rounded-pill bg-secondary" data-bs-toggle="tooltip" title="This variant was not yet submitted to ClinVar">no ClinVar submission</span>
                    {% endif %}
                </div>

                <!-- options dropdown -->
                <div class="dropdown ssl">
                    <button class="btn btn-secondary" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gear" viewBox="0 0 16 16">
                            <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                            <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"/>
                        </svg>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                        {% if session.get('user') is not none and 'user' in session['user']['roles']%}
                        <li>
                            <button id="reannotate_button" type="button" class="dropdown-item" data-bs-toggle="modal" data-bs-target="#reannotate-modal">(Re-)Annotate</button>
                        </li>
                        <li>
                            <a type="button" class="dropdown-item" href="{{url_for('variant_io.submit_assay', variant_id = variant[0])}}" 
                            data-bs-toggle="tooltip"  title="Submit an assay report & score for this variant.">
                                Submit assay
                            </a>
                        </li>
                        <li>
                            <a id="classify_button" type="button" class="dropdown-item" href="{{url_for('variant.classify', variant_id = variant[0])}}" 
                            data-bs-toggle="tooltip"  title="Submit a new variant classification or edit your previous classification(s).">
                                Classify
                            </a>
                        </li>
                        <li>
                            {% set disabled = '' %}
                            {% set title = 'Submit the consensus classification of this variant to ClinVar.' %}
                            {% if 'consensus_classification' not in annotations %}
                                {% set disabled = 'disabled' %}
                                {% set title = 'Create a consensus classification before submitting to ClinVar.' %}
                            {% endif %}
                            {% if 'submitted' == clinvar_submission['status'] or 'processing' == clinvar_submission['status'] %}
                                {% set disabled = 'disabled' %}
                                {% set title = 'Wait for the current ClinVar submission to finish before submitting another one.' %}
                            {% endif %}
                            <div data-bs-toggle="tooltip" title="{{ title }}"> <!-- idk why, but putting the tooltip on the button does not show it when the button is disabled -->
                                <button data-href="{{url_for('variant_io.submit_clinvar', variant_id = variant[0])}}" type="button" class="dropdown-item" {% if disabled == 'disabled' %} disabled="disabled" {% endif %}>
                                    Submit to ClinVar
                                </button>
                            </div>
                        </li>
                        {% endif %}
                        <li>
                            <a id="vcf_export_button" type="button" class="dropdown-item" href="{{url_for('download.variant', variant_id = variant[0])}}" 
                            data-bs-toggle="tooltip" title="Download this variant & all annotations as VCF.">
                                Export to VCF
                            </a>
                        </li>
                        <li>
                            <button class="dropdown-item" id="list_add_button" data-bs-toggle="modal" data-bs-target="#list-add-modal">Add to list</button>
                        </li>
                    </ul>
                </div>

            </div>

        </div>

        <!-- consensus classification label  at the top right -->
        {% if 'consensus_classification' in annotations %}
            {% set _consensus_class = annotations['consensus_classification'][3] %}
        {% else %}
            {% set _consensus_class = '-' %}
        {% endif %}
        <div class="ms-auto" style="margin-right: 1rem;">
            {{ macros.render_consensus_classification_label(_consensus_class) }}
        </div>
        


    </div>
</div>



<!-- reannotate confirmation panel (it is a bootstrap modal) -->
<div class="modal fade" id="reannotate-modal" tabindex="-1" aria-labelledby="reannotate-modal-label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reannotate-modal-label">Confirm (re-)annotation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure that you want to (re-)annotate this variant?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button id="reannotate-submit" type="button" class="btn btn-primary">Yes</button>
            </div>
        </div>
    </div>
</div>




<!-- reload page modal, because annotation is finished -->
<div class="modal fade" id="reload-modal" tabindex="-1" aria-labelledby="reload-modal-label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reload-modal-label">Annotation finished</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                The requested variant annotation is ready. <br> 
                Do you want to reload the page now to view the new annotations?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                <button id="reload-submit" type="button" class="btn btn-primary">Yes</button>
            </div>
        </div>
    </div>
</div>



<!-- modal for multiple variant to a list -->
{% set title = 'Select a list to add this variant to it. If a list is highlighted in blue the current variant is already in that list' %}
{% if lists | length == 0 %}
    {% set title = 'You do not have a variant list. Please navigate to the "my-lists" page to create one. The "my-lists" page can be found when clicking on your name at the top right corner of this page.' %}
{% endif %}
{{ macros.select_list_modal(lists,
                            'user.modify_list_content', 
                            {'variant_id':variant[0], 
                             'action':'add_to_list',
                             'next': url_for('variant.display', variant_id=variant[0])}, 
                            title) }}


<!--data-masonry='{"percentPosition": true }'-->
<!-- Variant identification -->
<div class="w-100 ssb">
    <div class="card variant-banner-color left-space-padding">
        
        <div class="card-text">
            <div class="table-responsive">
                <table class="table table-borderless table-slim">
                    <tbody>
                        <tr>
                            <td style="width:10rem" class="li-label"><abbr title="Variant in VCF style (FORMAT: chromosome -> position in reference genome (GRCh38) -> reference allele -> alternative allele)">VCF</abbr></td>
                            <td > 
                                <div style="word-break:break-all;">
                                    {{ variant[1] }}-{{ variant[2] }}-{{ variant[3] }}-{{ variant[4] }}
                                </div>
                            </td>
                        </tr>
                        {% if 'rsid' in annotations %}
                        <tr>
                            <td class="li-label"><abbr title="RSID from dbSNP">RSID</abbr></td>
                            <td >{{ macros.external_link("rs" + annotations['rsid'][4], "https://www.ncbi.nlm.nih.gov/snp/rs" + annotations['rsid'][4]) }}</td>
                        </tr>
                        {% endif %}
                        <!-- External Links / Further Information on external websites-->
                        <tr>
                            <td class="li-label">External&nbsp;resources</td>
                            <td style="vertical-align:middle;">
                                
                                <ul class="list-group list-group-horizontal-sm list-nopad-td list-nobackground" >
                                    <li class="list-group-item noboarder-td" >
                                        {{ macros.external_link("UCSC", "https://genome.ucsc.edu/cgi-bin/hgTracks?db=hg38&position=chr2%3A" + variant[2]|string) }}
                                    </li>
                                    <li class="list-group-item noboarder-td">
                                        {{ macros.external_link("gnomAD", "https://gnomad.broadinstitute.org/variant/" + variant[1][3:]|string + "-" + variant[2]|string + "-" + variant[3]|string + "-" + variant[4]|string + "?dataset=gnomad_r3") }}
                                    </li>
                                    <li class="list-group-item noboarder-td">
                                        {{ macros.external_link("VarSome", "https://varsome.com/security-validation/?next=/variant/hg19/" + variant[1][3:]|string + ":" + variant[2]|string + ":" + variant[3]|string + ":" + variant[4]|string) }}
                                    </li>
                                    {% if 'rsid' in annotations %}
                                    <li class="list-group-item noboarder-td">
                                        {{ macros.external_link("dbSNP", "https://www.ncbi.nlm.nih.gov/snp/rs" + annotations['rsid'][4]|string) }}
                                    </li>
                                    {% endif %}
                                    {% if 'clinvar_variant_annotation' in annotations %}
                                    <li class="list-group-item noboarder-td">
                                        {{ macros.external_link("ClinVar", "https://www.ncbi.nlm.nih.gov/clinvar/variation/" + annotations['clinvar_variant_annotation'][2]|string) }}
                                    </li>
                                    {% endif %}
                                    {% if 'variant_consequences' in annotations %}
                                        {% for consequence in annotations['variant_consequences'] %}
                                            {% if consequence[0] == ENST00000269305 %} <!-- This transcript is the recommended one for TP53 (see https://www.ensembl.org/Homo_sapiens/Gene/Summary?db=core;g=ENSG00000141510;r=17:7661779-7687538) and encodes the alpha isoform for this gene -->
                                            <li class="list-group-item noboarder-td">
                                                {{ macros.external_link("PHANTM", "https://mutantp53.broadinstitute.org/mutantp53grade/?query=" + consequence[2]|string) }}
                                            </li>
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                </ul>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
        </div>
    </div>
</div>



<!-- navigator tabs -->
<ul class="nav nav-tabs" id="tabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="classification-tab" data-bs-toggle="tab" data-bs-target="#classification" type="button" role="tab" aria-controls="classification" aria-selected="true">Classification</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="pop_score-tab" data-bs-toggle="tab" data-bs-target="#pop_score" type="button" role="tab" aria-controls="pop_score" aria-selected="false">Population & in-silico annotations</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="consequence-tab" data-bs-toggle="tab" data-bs-target="#consequence" type="button" role="tab" aria-controls="consequence" aria-selected="false">Consequence</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="assay-tab" data-bs-toggle="tab" data-bs-target="#assay" type="button" role="tab" aria-controls="assay" aria-selected="false">Assays</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="literature-tab" data-bs-toggle="tab" data-bs-target="#literature" type="button" role="tab" aria-controls="literature" aria-selected="false">Literature</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="igv-tab" data-bs-toggle="tab" data-bs-target="#igv" type="button" role="tab" aria-controls="igv" aria-selected="false">IGV</button>
    </li>
</ul>


<!-- tab content -->
<div class="tab-content" id="TabContent">


    <div class="tab-pane fade show active" id="classification" role="tabpanel" aria-labelledby="classification-tab">
            
            
            
    <!--available classifications-->
    <div class="w-100 ssb">
        <div class="card" style="border-top:0; border-top-left-radius: 0; border-top-right-radius: 0;">
            <div class="card-body">

                    <div class="d-flex align-items-center">
                        <h4 class="card-subcaption flex-grow-1">HerediVar classifications</h4>
                        <a class="btn btn-outline-primary" href="{{ url_for('variant.classification_history', variant_id=variant[0]) }}">view history</a>
                    </div>

                    <!-- HEREDIVAR -->
                    <!-- most recent consensus classification -->
                    <div class="ssl ssb">
                        {{ macros.draw_most_recent_consensus_classification(annotations.get('consensus_classification')) }}
                    </div>
                    <!-- user classification table -->
                    {% if 'user_classifications' in annotations %}
                    <h4 class="card-subcaption">HerediVar user classifications</h4>
                    <div class="ssl ssb">
                        <div class="table-responsive tableFixHead">
                            <table class="table table-hover" id="userClassificationsTable">
                                <thead>
                                    <tr>
                                        <th style="width:3rem"><div class="sortable">Final class</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th style="width:10rem"><div class="sortable">Submitter</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th style="width:10rem"><div class="sortable">Affiliation</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th style="width:15rem" id="userClassificationsTableDateCol"><div class="sortable">Date</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th><div class="sortable">Comment</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th style="width:15rem"><div class="sortable">Scheme</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th style="width:40rem"><div class="sortable">Selected criteria</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th style="width:5rem"><div class="sortable">Class by scheme</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th style="width:7rem"><div class="sortable">Literature</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for classification in annotations['user_classifications'] %}
                                    <tr user_classification_id="{{ classification[0] }}">
                                        <td style="text-align:center">{{ classification[1] }}</td>
                                        <td>{{ classification[8] + ' ' + classification[9] }}</td>
                                        <td>{{ classification[10] }}</td>
                                        <td style="white-space:nowrap;">{{ classification[5] }}</td>
                                        <td><abbr title="{{ classification[4] }}"><div class="Nellipsis">{{ classification[4] }}</div> </abbr></td>
                                        <td style="white-space:nowrap;">{{ classification[11] }}</td>
                                        <td>{{ macros.draw_criteria_display(classification[13], '4em', '2em') }}</td>
                                        <td>{{ classification[15] }}</td>
                                        <td>{{ macros.selected_literature_display(classification[14]) }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {% endif %}

                    <!-- heredicare center classifications -->
                    {% if 'heredicare_center_classifications' in annotations %}
                    <h4 class="card-subcaption">HerediCare center classifications</h4>
                    <div class="ssl sst ssb">
                        <div class="table-responsive tableFixHead">
                            <table class="table table-hover" id="heredicareCenterClassificationsTable">
                                <thead>
                                    <tr>
                                        <th style="width:2.5rem"><div class="sortable">Class</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th><div class="sortable">Center</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th id="heredicareCenterClassificationsTableDateCol"><div class="sortable">Date</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th style="min-width:20rem"><div class="sortable">Comment</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for classification in annotations['heredicare_center_classifications'] %}
                                    <tr heredicare_center_classification_id="{{ classification[0] }}">
                                        <td>{{ classification[1] }}</td>
                                        <td>{{ classification[3] }}</td>
                                        <td style="white-space:nowrap;">{{ classification[5] }}</td>
                                        <td>{{ classification[4] }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {% endif %}

                    {% if 'clinvar_variant_annotation' in annotations %}
                    <h4 class="card-subcaption">ClinVar classifications</h4>

                    <!-- CLINVAR -->
                    <div class="ssl sst ssb">
                        <div>
                            <abbr title="The review status from ClinVar"><a class="dashed_underline">review status:</a></abbr>&nbsp;{{annotations['clinvar_variant_annotation'][4]}}
                        </div>

                        <div>
                            <abbr title="A summary of the ClinVar interpretations. The numbers in brackets display the number of ClinVar submissions reporting the specific type of interpretation."><a class="dashed_underline">interpretation summary:</a></abbr>&nbsp;{{annotations['clinvar_variant_annotation'][3]}}
                        </div>
                    </div>
                    <!-- clinvar submission table -->
                    {% if 'clinvar_submissions' in annotations %}
                    <div class="ssl ssb">
                        <div class="table-responsive tableFixHead">
                            <table class="table table-hover" style="width:100%" id="clinvarSubmissionsTable">
                                <thead>
                                    <tr>
                                        <th><div class="sortable">Interpretation</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th id="clinvarSubmissionsTableLastEvaluatedCol"><div class="sortable">Last evaluated</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th style="min-width:9rem"><div class="sortable">Review status</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th style="min-width:13rem"><div class="sortable">Submission condition</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th style="min-width:20rem"><div class="sortable">Submitter</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th style="min-width:20rem;">Comment<input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for submission in annotations['clinvar_submissions'] %}
                                    <tr clinvar_id="{{submission[0]}}">
                                        <td>{{ submission[2] }}</td>
                                        <td style="white-space:nowrap;">{{ submission[3] }}</td>
                                        <td>{{ submission[4] }}</td>
                                        <td>
                                            {% for clinvar_submission_condition in submission[5] %}
                                                <div>
                                                    {{ macros.external_link(clinvar_submission_condition[1], "https://www.ncbi.nlm.nih.gov/medgen/" + clinvar_submission_condition[0]) }}
                                                </div>
                                                
                                            {% endfor %}
                                            
                                        </td>
                                        <td>{{ submission[6] }}</td>
                                        <td ><abbr title="{{ submission[7] }}"><div class="Nellipsis" >{{ submission[7] }}</div> </abbr></td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {% endif %}
                    {% endif %}

                    {% if 'brca_exchange_clinical_significance' in annotations %}
                    <h4 class="card-subcaption">BRCA exchange classification</h4>

                    <!-- BRCA-EXCHANGE -->
                    <div class="ssl">
                        {{annotations['brca_exchange_clinical_significance'][4]}}
                    </div>
                    {% endif %}

                    {% if 'arup_classification' in annotations %}
                    <h4 class="card-subcaption">ARUP BRCA classification</h4>

                    <!-- ARUP -->
                    <div class="ssl">
                        {{annotations['arup_classification'][4]}}
                    </div>
                    {% endif %}

            </div>
        </div>
    </div>



    </div>

    <div class="tab-pane fade" id="pop_score" role="tabpanel" aria-labelledby="pop_score-tab">
            
            
    <!--variant information-->
    <div class="w-100 ssb">
        <div class="card" style="border-top:0; border-top-left-radius: 0; border-top-right-radius: 0;">
            <div class="card-body">
                <h4 class="card-subcaption">Variant information</h4>

                <div class="table-responsive">
                    <table class="table table-borderless table-border-between" style="table-layout: fixed; display: inline-block; overflow-x:auto;">


                        <thead>
                            <tr>
                                <th style="width: 10rem;"></th>
                                <th style="width:100%"></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% set standard_annotations = annotations['standard_annotations'] %}
                            {% for annotation_group in standard_annotations %}
                                <tr style="margin-top:100;">
                                    <td class="li-label" style="white-space: nowrap;">{{ annotation_group }}</td>
                                    <td>
                                        {% set current_annotations = standard_annotations[annotation_group] %}
                                        {% for annotation_type in current_annotations %}
                                            {% if annotation_type == 'hexplorer' or annotation_type == 'hexplorer_rev' or annotation_type == 'max_hbond' or annotation_type == 'max_hbond_rev' %} <!-- add details for hexplorer/hbond score -->
                                                {{ macros.draw_hexplorer_score(current_annotations[annotation_type][7], current_annotations[annotation_type], current_annotations.get(annotation_type + '_wt'), current_annotations.get(annotation_type + '_mut')) }}
                                            {% else %}
                                            {% if 'heredicare' in annotation_type %} <!-- add red exclamation mark for heredicare counts -->
                                                <div annotation_id="{{current_annotations[annotation_type][8]}}">
                                                    {% if has_multiple_vids  %}
                                                        {{ macros.draw_exclamation_mark('Multiple VIDs in HerediCare for this variant. Thus, these counts might be inaccurate!') }}
                                                    {% endif %}
                                                    <abbr class="ssr" title="{{current_annotations[annotation_type][0]}}"><a class="dashed_underline">{{ annotation_type }}:</a></abbr>{{ current_annotations[annotation_type][4] }}
                                                </div>
                                            {% else %}
                                            {% if 'spliceai_details' == annotation_type %} <!-- add details for spliceai -->
                                                {% set spliceai_details_values = current_annotations['spliceai_details'][4].split(',') %}
                                                <div class="d-flex" annotation_id="{{current_annotations[annotation_type][8]}};{{current_annotations['spliceai_max_delta'][8]}}">
                                                    <abbr class="ssr" title="{{current_annotations['spliceai_max_delta'][0]}}"><a class="dashed_underline">{{ current_annotations[annotation_type][7] }}:</a></abbr>


                                                    <ul class="list-group list-group-horizontal-sm list-nopad-td list-nobackground" >
                                                        {% for spliceai in spliceai_details_values %}
                                                        <li class="list-group-item noboarder-td" >
                                                            <div class="d-flex">
                                                                <div class="ssr">{{ spliceai.split('|')[0] }}:</div> <div class="ssr">{{ spliceai.split('|')[1:5] | map('float') | max }}</div>
                                                                <a class="link" tabindex="0" role="button" data-bs-toggle="popover" data-bs-html="true" data-bs-trigger="focus" 
                                                                    data-bs-content="{{ current_annotations['spliceai_details'][0] }} <br/> {{ spliceai }}">
                                                                        details
                                                                </a>
                                                            </div>
    
                                                        </li>
                                                        {% endfor %}
                                                    </ul>
                                                </div>



                                            {% else %}
                                            {% if 'cancerhotspots_cancertypes' == annotation_type %} <!-- handle cancerhotspots cancertypes -->
                                                {% set cancerhotspots_cancertypes = current_annotations['cancerhotspots_cancertypes'][4].split('|') %}
                                                <div class="table-responsive tableFixHead" annotation_id="{{current_annotations[annotation_type][8]}}">
                                                    <table class="table table-hover" style="max-height:15em" id="cancerhotspots_table">
                                                        <thead>
                                                            <tr>
                                                                <th style="width: 100%; background:white; padding:0;">
                                                                    <div class="sortable"><a class="dashed_underline">cancertypes</a></div>
                                                                    <input type="text" class="form-control form-control-sm column-filter sst" style="max-width:10em" placeholder="search..." autocomplete="off">
                                                                </th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for cancer in cancerhotspots_cancertypes %}
                                                                <tr>
                                                                    <td style="width:100%">{{ cancer.replace(':', ': ') }}</td>
                                                                </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            {% else %}
                                            {% if '_mut' not in annotation_type and '_wt' not in annotation_type and 'spliceai' not in annotation_type %} <!-- standard case -->
                                                <div style="word-break: break-all;" annotation_id="{{current_annotations[annotation_type][8]}}">
                                                    <abbr class="ssr" title="{{current_annotations[annotation_type][0]}}"><a class="dashed_underline">{{ current_annotations[annotation_type][7] }}:</a></abbr>{{ current_annotations[annotation_type][4] }}
                                                </div>
                                            {% endif %}
                                            {% endif %}
                                            {% endif %}
                                            {% endif %}
                                            {% endif %}
                                        {% endfor %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>


    </div>

    <div class="tab-pane fade" id="consequence" role="tabpanel" aria-labelledby="consequence-tab">
            
            
   
    <!-- variant consequence table -->
    <!-- 0transcript_name,1hgvs_c,2hgvs_p,3consequence,4impact,5exon_nr,6intron_nr,7symbol,8transcript.gene_id,9source,10pfam_accession,11pfam_description,12length,13is_gencode_basic,14is_mane_select,15is_mane_plus_clinical,16is_ensembl_canonical,17total_flag -->

    <div class="w-100 ssb">
        <div class="card" style="border-top:0; border-top-left-radius: 0; border-top-right-radius: 0;">
            <div class="card-body">
                <h4 class="card-subcaption">Variant consequences</h4>

                <p class="card-text">
                    Preferred transcripts are shown first (longer and more flags) <br>
                    COSMIC links might be broken, as you can not search for them, so there might be wrong results...

                    <ul class="nav nav-tabs" id="tabs" role="tablist"> <!-- although this uses the styles from a tablist it is essentially not a tablist as it is not linked to the tabContent div below! Changes appear through javascript-->
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" data-bs-toggle="tab" type="button" role="tab" aria-selected="true" onclick="filter_consequence_table('ensembl')">Ensembl</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" data-bs-toggle="tab" type="button" role="tab" aria-selected="false" onclick="filter_consequence_table('refseq')">RefSeq</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="tabContent">

                        <div class="table-responsive tableFixHead table-lg">
                            <table class="table table-hover" id="variantConsequenceTable">
                                <thead>
                                    <tr>
                                        <th><div class="sortable">Transcript Name</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th><div class="sortable">HGVS_C</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th><div class="sortable">HGVS_P</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th><div class="sortable">Consequence</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th><div class="sortable">Impact</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th><div class="sortable">Exon Nr.</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th><div class="sortable">Intron Nr.</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th id="variant_consequence_gene_symbol_col" asc="false"><div class="sortable">Gene Symbol</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th><div class="sortable">Protein Domain</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        <th><div class="sortable">Flags</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                        
                                        <th style="display:none;" id="variant_consequence_source_col">Source</th>
                                        <th id="variant_consequence_length_col" asc="true"><div class="sortable">Length</div></th>
                                        <th style="display:none;" id="variant_consequence_numflags_col" asc="true">NumFlags</th>
                                        <th >Links</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for consequence in annotations['variant_consequences'] %}
                                    <tr>
                                        <td style="white-space:nowrap;">{{ consequence[0] }}</td>
                                        <td style="white-space:nowrap;">{{ consequence[1] }}</td>
                                        <td style="white-space:nowrap;">{{ consequence[2] }}</td>
                                        <td>{{ consequence[3] }}</td>
                                        <td>{{ consequence[4] }}</td>
                                        <td>{{ consequence[5] }}</td>
                                        <td>{{ consequence[6] }}</td>
                                        <td>
                                            {% if consequence[7] is not none %}
                                                <a href="{{ url_for('extended_information.gene', gene_id=consequence[8] | int) }}">{{ consequence[7] }}</a>
                                            {% else %}
                                                {{ consequence[7] }}
                                            {% endif %}
                                        </td>
                                        {% if consequence[11] is not none %}
                                        <td>
                                            {{ macros.external_link(consequence[11], "https://pfam.xfam.org/family/" + consequence[10]) }}
                                        </td>
                                        {% else %}
                                        <td>{{ consequence[11] }}</td>
                                        {% endif %}
                                        <td>
                                            {% if consequence[13] %}
                                                <span class="badge bg-secondary"><abbr title="This flag describes a subset of representative transcripts of the GENCODE set of genes.">GENCODE basic</abbr></span>
                                            {% endif %}
                                            {% if consequence[14] %}
                                                <span class="badge bg-secondary"><abbr title="Each MANE (Matched Annotation from the NCBI and EMBL-EBI) transcript represents an exact match in exonic regions between a Refseq transcript and its counterpart in the Ensembl/GENCODE. The MANE Select set consists of one transcript at each protein-coding locus across the genome that is representative of biology at that locus. This set is useful as a universal standard for clinical reporting. MANE Select transcripts are identified using computational methods complemented by manual review and discussion.">MANE select</abbr></span>
                                            {% endif %}
                                            {% if consequence[15] %}
                                                <span class="badge bg-secondary"><abbr title="Each MANE (Matched Annotation from the NCBI and EMBL-EBI) transcript represents an exact match in exonic regions between a Refseq transcript and its counterpart in the Ensembl/GENCODE. The MANE Plus Clinical set includes additional transcripts for genes where MANE Select alone is not sufficient to report all pathogenic or likely pathogenic clinical variants available in public resources.">MANE clin</abbr></span>
                                            {% endif %}
                                            {% if consequence[16] %}
                                                <span class="badge bg-secondary"><abbr title="The Ensembl Canonical transcript is a single, representative transcript identified at every locus using different transcript-traits like the highest coverage of conserved exons, highest expression, longest coding sequence and is represented in other key resources, such as NCBI and UniProt.">ensembl canonical</abbr></span>
                                            {% endif %}
                                        </td>

                                        <td style="display:none;">{{ consequence[9] }}</td>
                                        <td >{{ consequence[12] }}</td>
                                        <td style="display:none;">{{ consequence[17] }}</td>

                                        <td>
                                            
                                            {% set rsid = none %}
                                            {% if 'rsid' in annotations %}
                                                {% set rsid = annotations['rsid'][4] %}
                                            {% endif %}
                                        
                                        
                                            {{ macros.google_link("google", rsid = rsid, hgvs_c = consequence[1], hgvs_p = consequence[2], gene_name = consequence[7], is_scholar = False) }}
                                            {{ macros.google_link("scholar", rsid = rsid, hgvs_c = consequence[1], hgvs_p = consequence[2], gene_name = consequence[7], is_scholar = True) }}

                                            {% if consequence[7] is not none and consequence[1] is not none %}
                                                {{ macros.external_link("COSMIC", "https://cancer.sanger.ac.uk/cosmic/search?q=" + consequence[7] + "+" + consequence[1] | replace('>','%3E')) }}
                                            {% endif %}
                                            {% if consequence[7] in ['MLH1', 'MSH2', 'MSH6', 'PMS2'] %}
                                                {{ macros.external_link("InSiGHT", "http://www.insight-database.org/classifications/index.html?gene=" + consequence[7] + "&variant=" + consequence[1] | replace('>', '%3E')) }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                    </div>
                </p>
            </div>
        </div>
    </div>




        </div>
        <div class="tab-pane fade" id="assay" role="tabpanel" aria-labelledby="assay-tab">

    <div class="w-100 ssb">
        <div class="card" style="border-top:0; border-top-left-radius: 0; border-top-right-radius: 0;">
            <div class="card-body">
                <h4 class="card-subcaption">Assays</h4>
                
                <p class="card-text">
                    <div class="table-responsive tableFixHead table-lg">
                        <table class="table table-hover" id="assayTable">
                            <thead>
                                <tr>
                                    <th id="assayTableAssayTypeCol" asc="false"><div class="sortable">Assay type</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                    <th><div class="sortable">Score</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                    <th id="assayTableDateCol"><div class="sortable">Date</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                    <th><div class="sortable">Report</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for assay in annotations['assays'] %}
                                <tr assay_id="assay[0]">
                                    <td style="min-width:10rem">{{assay[1]}}</td>
                                    <td style="min-width:6rem">{{ assay[2] }}</td>
                                    <td style="min-width:8rem; white-space: nobreak;">{{assay[3]}}</td>
                                    <td style="min-width:10rem"><a href="{{ url_for('download.assay_report', assay_id=assay[0]) }}">Download report</a></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </p>

            </div>
        </div>
    </div>






        </div>
        <div class="tab-pane fade" id="literature" role="tabpanel" aria-labelledby="literature-tab">
            
            

    <!-- literature table -->

    <div class="w-100 ssb">
        <div class="card" style="border-top:0; border-top-left-radius: 0; border-top-right-radius: 0;">
            <div class="card-body">
                <h4 class="card-subcaption">Literature</h4>

                <p class="card-text">
                    <div class="table-responsive tableFixHead table-lg">
                        <table class="table table-hover" id="literatureTable">
                            <thead>
                                <tr>
                                    <th style="width:2.5rem" id="literatureTableYearCol"><div class="sortable">Year</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                    <th><div class="sortable">Authors</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                    <th ><div class="sortable">Title</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                    <th><div class="sortable">Journal / Publisher</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                    <th>Link</th>
                                    <th><div class="sortable">Source</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for paper in annotations['literature'] %}
                                <tr>
                                    <td>{{paper[6]}}</td>
                                    <td style="max-width:30rem"><abbr title="{{ paper[4] }}"><div class="Nellipsis">{{ paper[4] }}</div> </abbr></td>
                                    <td style="min-width:30rem">{{paper[3]}}</td>
                                    <td style="min-width:10rem">{{paper[5]}}</td>
                                    <td style="text-align:center;">
                                        {{ macros.external_link("PMID:" + paper[2]|string, "https://pubmed.ncbi.nlm.nih.gov/" + paper[2]|string) }}
                                    </td>
                                    <td style="width:1rem">{{ paper[7] }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </p>
            </div>
        </div>
    </div>




    </div>
    <div class="tab-pane fade" id="igv" role="tabpanel" aria-labelledby="igv-tab">
        <div class="w-100 ssb">
            <div class="card" style="border-top:0; border-top-left-radius: 0; border-top-right-radius: 0;">
                <div class="card-body">
                    <h4 class="card-subcaption">IGV</h4>
    
                    <p class="card-text">
                        <div id="igv-container"></div>
                    </p>
                </div>
            </div>
        </div>
    </div>

</div>

{% endblock %}





{% block special_scripts %}
    <script src="/static/js/variant.js"></script>
{% endblock%}

<!--
    - variant consequences nach preferred transcripts sortieren und badges (mane select, ....) anzeigen
    - gene page
    - genids durch gennamen ersetzen in variant consequence table
    - nobreak fr bestimmte spalten
    ~ minimale seitenbreite angeben
    - beim variant import vcf check laufen lassen
    ~ variant import auch von hgvs mglich machen
    external links karte einfgen
    abbr beschreibungen der flags einfgen
    variant consequence table nach refseq / ensembl filtern (mit toggle)
    transcript table auf gene page einfgen
    refseq transcripts importieren + mapping table enst -> refseq
    - umbruch der last evaluated daten verhindern in clinvar submissions table
    - clinvar submissions standardmig nach last evaluated sortieren
    - wenn variante erfolgreich hochgeladen wurde soll der link gleich angezeigt werden in der flashed message

    - add positive feedback if variant was imported successfully
-->