
{% macro render_theC(width, source) %}
<svg id="theC" class="the_c" data-bs-toggle="tooltip" title="" data-bs-placement="left" xmlns="http://www.w3.org/2000/svg" width="{{ width }}" viewBox="0 0 250 250" preserveAspectRatio="xMidYMid meet" fill="currentColor">
    <path d="M212.5,172.3c-16.9,31.1-49.8,52.2-87.6,52.2c-54.9,0-99.5-44.6-99.5-99.5c0-54.9,44.6-99.5,99.5-99.5   c38.3,0,71.6,21.8,88.2,53.6h28C222.9,32.8,177.7,0,125,0C56.1,0,0,56.1,0,125c0,68.9,56.1,125,125,125c52.2,0,97-32.2,115.7-77.7   H212.5z"/>
    {% if source == "heredicare" %}
    <path fill="red" transform="translate(5,5) scale(5)" class="white_border" fill-rule="evenodd" d="M8 0a5.53 5.53 0 0 0-3.594 1.342c-.766.66-1.321 1.52-1.464 2.383C1.266 4.095 0 5.555 0 7.318 0 9.366 1.708 11 3.781 11H7.5V5.5a.5.5 0 0 1 1 0V11h4.188C14.502 11 16 9.57 16 7.773c0-1.636-1.242-2.969-2.834-3.194C12.923 1.999 10.69 0 8 0zm-.354 15.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 14.293V11h-1v3.293l-2.146-2.147a.5.5 0 0 0-.708.708l3 3z"/>
    {% endif %}
</svg>
{% endmacro %}



{% macro render_consensus_classification_label(class, source, width='6em') %}
<!-- position this element when you use it! -->
    <div class="class_label" name="class-label" classification="{{ class }}" >
        {{ render_theC(width, source) }}

        {% if class == "1" or class == "2" or class == "3" or class == "4" or class == "5" %}
        <svg name="consensus_class_svg" xmlns="http://www.w3.org/2000/svg" width="{{ width }}" viewBox="-7.6 6.2 30 30" preserveAspectRatio="xMidYMid meet" fill="currentColor">
            {% if class == "1" %}
            <path d="M9.442,30.084H7.333V16.643c-0.508,0.484-1.174,0.969-1.998,1.453s-1.564,0.848-2.221,1.09v-2.039   c1.18-0.555,2.211-1.227,3.094-2.016s1.508-1.555,1.875-2.297h1.359V30.084z"/>
            {% endif %}
            {% if class == "2" %}
            <path d="M12.583,28.057v2.027H1.228c-0.016-0.508,0.066-0.996,0.246-1.465c0.289-0.773,0.752-1.535,1.389-2.285   s1.557-1.617,2.76-2.602c1.867-1.531,3.129-2.744,3.785-3.639s0.984-1.74,0.984-2.537c0-0.836-0.299-1.541-0.896-2.115   s-1.377-0.861-2.338-0.861c-1.016,0-1.828,0.305-2.438,0.914s-0.918,1.453-0.926,2.531l-2.168-0.223   c0.148-1.617,0.707-2.85,1.676-3.697s2.27-1.271,3.902-1.271c1.648,0,2.953,0.457,3.914,1.371s1.441,2.047,1.441,3.398   c0,0.688-0.141,1.363-0.422,2.027s-0.748,1.363-1.4,2.098s-1.736,1.742-3.252,3.023c-1.266,1.063-2.078,1.783-2.438,2.162   s-0.656,0.76-0.891,1.143H12.583z"/>
            {% endif %}
            {% if class == "3-" %}
            <path d="M1.509,25.549l2.109-0.281c0.242,1.195,0.654,2.057,1.236,2.584s1.291,0.791,2.127,0.791c0.992,0,1.83-0.344,2.514-1.031   s1.025-1.539,1.025-2.555c0-0.969-0.316-1.768-0.949-2.396s-1.438-0.943-2.414-0.943c-0.398,0-0.895,0.078-1.488,0.234L5.903,20.1   c0.141,0.016,0.254,0.023,0.34,0.023c0.898,0,1.707-0.234,2.426-0.703s1.078-1.191,1.078-2.168c0-0.773-0.262-1.414-0.785-1.922   s-1.199-0.762-2.027-0.762c-0.82,0-1.504,0.258-2.051,0.773s-0.898,1.289-1.055,2.32L1.72,17.288   c0.258-1.414,0.844-2.51,1.758-3.287s2.051-1.166,3.41-1.166c0.938,0,1.801,0.201,2.59,0.604s1.393,0.951,1.811,1.646   s0.627,1.434,0.627,2.215c0,0.742-0.199,1.418-0.598,2.027s-0.988,1.094-1.77,1.453c1.016,0.234,1.805,0.721,2.367,1.459   s0.844,1.662,0.844,2.771c0,1.5-0.547,2.771-1.641,3.814s-2.477,1.564-4.148,1.564c-1.508,0-2.76-0.449-3.756-1.348   S1.649,26.979,1.509,25.549z"/>
            <path  d="M11 7.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5z"/>
            {% endif %}
            {% if class == "3" %}
            <path d="M1.509,25.549l2.109-0.281c0.242,1.195,0.654,2.057,1.236,2.584s1.291,0.791,2.127,0.791c0.992,0,1.83-0.344,2.514-1.031   s1.025-1.539,1.025-2.555c0-0.969-0.316-1.768-0.949-2.396s-1.438-0.943-2.414-0.943c-0.398,0-0.895,0.078-1.488,0.234L5.903,20.1   c0.141,0.016,0.254,0.023,0.34,0.023c0.898,0,1.707-0.234,2.426-0.703s1.078-1.191,1.078-2.168c0-0.773-0.262-1.414-0.785-1.922   s-1.199-0.762-2.027-0.762c-0.82,0-1.504,0.258-2.051,0.773s-0.898,1.289-1.055,2.32L1.72,17.288   c0.258-1.414,0.844-2.51,1.758-3.287s2.051-1.166,3.41-1.166c0.938,0,1.801,0.201,2.59,0.604s1.393,0.951,1.811,1.646   s0.627,1.434,0.627,2.215c0,0.742-0.199,1.418-0.598,2.027s-0.988,1.094-1.77,1.453c1.016,0.234,1.805,0.721,2.367,1.459   s0.844,1.662,0.844,2.771c0,1.5-0.547,2.771-1.641,3.814s-2.477,1.564-4.148,1.564c-1.508,0-2.76-0.449-3.756-1.348   S1.649,26.979,1.509,25.549z"/>
            {% endif %}
            {% if class == "4" %}
            <path d="M8.259,30.084v-4.113H0.806v-1.934l7.84-11.133h1.723v11.133h2.32v1.934h-2.32v4.113H8.259z M8.259,24.038v-7.746   L2.88,24.038H8.259z"/>
            {% endif %}
            {% if class == "5" %}
            <path d="M1.497,25.584l2.215-0.188c0.164,1.078,0.545,1.889,1.143,2.432s1.318,0.814,2.162,0.814c1.016,0,1.875-0.383,2.578-1.148   s1.055-1.781,1.055-3.047c0-1.203-0.338-2.152-1.014-2.848s-1.561-1.043-2.654-1.043c-0.68,0-1.293,0.154-1.84,0.463   s-0.977,0.709-1.289,1.201l-1.98-0.258l1.664-8.824h8.543v2.016H5.224l-0.926,4.617c1.031-0.719,2.113-1.078,3.246-1.078   c1.5,0,2.766,0.52,3.797,1.559s1.547,2.375,1.547,4.008c0,1.555-0.453,2.898-1.359,4.031c-1.102,1.391-2.605,2.086-4.512,2.086   c-1.563,0-2.838-0.438-3.826-1.313S1.638,27.03,1.497,25.584z"/>
            {% endif %}
        </svg>
        {% else %}
        {% if class == "3-" or class == "3+" %}
        <svg name="consensus_class_svg" xmlns="http://www.w3.org/2000/svg" width="{{ width }}" viewBox="-5.6 6.2 30 30" preserveAspectRatio="xMidYMid meet" fill="currentColor">
            <path d="M1.509,25.549l2.109-0.281c0.242,1.195,0.654,2.057,1.236,2.584s1.291,0.791,2.127,0.791c0.992,0,1.83-0.344,2.514-1.031   s1.025-1.539,1.025-2.555c0-0.969-0.316-1.768-0.949-2.396s-1.438-0.943-2.414-0.943c-0.398,0-0.895,0.078-1.488,0.234L5.903,20.1   c0.141,0.016,0.254,0.023,0.34,0.023c0.898,0,1.707-0.234,2.426-0.703s1.078-1.191,1.078-2.168c0-0.773-0.262-1.414-0.785-1.922   s-1.199-0.762-2.027-0.762c-0.82,0-1.504,0.258-2.051,0.773s-0.898,1.289-1.055,2.32L1.72,17.288   c0.258-1.414,0.844-2.51,1.758-3.287s2.051-1.166,3.41-1.166c0.938,0,1.801,0.201,2.59,0.604s1.393,0.951,1.811,1.646   s0.627,1.434,0.627,2.215c0,0.742-0.199,1.418-0.598,2.027s-0.988,1.094-1.77,1.453c1.016,0.234,1.805,0.721,2.367,1.459   s0.844,1.662,0.844,2.771c0,1.5-0.547,2.771-1.641,3.814s-2.477,1.564-4.148,1.564c-1.508,0-2.76-0.449-3.756-1.348   S1.649,26.979,1.509,25.549z"/>
            {% if class == "3-" %}
            <path transform="translate(2.5,0)" d="M11 20.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1.5h-4a.5.5 0 0 1-.5-.5z"/>
            {% endif %}
            {% if class == "3+" %}
            <path transform="translate(6.5,8) scale(1.3)" fill-rule="evenodd" d="M8 7.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V12a.5.5 0 0 1-1 0v-1.5H6a.5.5 0 0 1 0-1h1.5V8a.5.5 0 0 1 .5-.5z"/>
            {% endif %}
        </svg>
        {% else %}
        {% if class == "4M" %}
        <svg name="consensus_class_svg" xmlns="http://www.w3.org/2000/svg" width="{{ width }}" viewBox="2.469 1.934 10 10" preserveAspectRatio="xMidYMid meet" fill="currentColor">
            <!--<path transform="translate(-4,10) scale(1.3)" d="M5.295 11V5.995H7V5H2.403v.994h1.701V11h1.19zm3.397 0V7.01h.058l1.428 3.239h.773l1.42-3.24h.057V11H13.5V5.001h-1.2l-1.71 3.894h-.039l-1.71-3.894H7.634V11h1.06z"/>-->
            <text class="classM_text" x="3.9" y="8.8">4M</text>
        </svg>
        {% else %}
        {% if class == "R" %}
        <svg name="consensus_class_svg" xmlns="http://www.w3.org/2000/svg" width="{{ width }}" viewBox="2.469 1.934 10 10" preserveAspectRatio="xMidYMid meet" fill="currentColor">
            <text class="classR_text" x="4.7" y="10">R</text>
        </svg>
        {% else %}
        <svg name="consensus_class_svg" xmlns="http://www.w3.org/2000/svg" width="{{ width }}" fill="currentColor" class="bi bi-dash" viewBox="5.5 -0.7 16 16" preserveAspectRatio="xMidYMid meet">
            <path d="M11 7.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5z"/>
        </svg>
        {% endif %}
        {% endif %}
        {% endif %}
        {% endif %}
    </div>
{% endmacro %}




{% macro draw_most_recent_consensus_classification(most_recent_consensus_classification) %}
{% if most_recent_consensus_classification is not none %}
    <div class="classification-gradient left-space-padding" name="consensus_class_display" classification="{{ most_recent_consensus_classification.selected_class }}">
        <table class="table table-borderless table-slim" consensus_classification_id="{{ most_recent_consensus_classification.id }}">
            <tbody>
                <tr class="nsl">
                    <td class="li-label width_very_small">Data</td>
                    <td class="vertical_align_middle">
                        <ul class="list-group list-group-horizontal-sm list-nopad-td list-nobackground" >
                            <li class="list-group-item noboarder-td">
                                Class: {{ most_recent_consensus_classification.selected_class }}
                            </li>
                            <li class="list-group-item noboarder-td">
                                Date: {{ most_recent_consensus_classification.date }}
                            </li>
                            <li class="list-group-item noboarder-td">
                                Evidence document: <a class="remove_link" href="{{url_for('download.evidence_document', consensus_classification_id=most_recent_consensus_classification.id ) }}">download</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="li-label">Comment</td>
                    <td><div class="wrap-spaces">{{ most_recent_consensus_classification.get_comment_display() }}</div></td>
                </tr>

                {% set selected_scheme = most_recent_consensus_classification.scheme %}
                {% set selected_criteria = selected_scheme.get_criteria_sorted() %}<!-- the consensus scheme classifications should only contain the most recent classification -->
                {% set scheme_determined_class = selected_scheme.selected_class %}

                <tr class="nsl">
                    <td class="li-label width_very_small">Scheme</td>
                    <td class="vertical_align_middle">
                        <ul class="list-group list-group-horizontal-sm list-nopad-td list-nobackground" >
                            <li class="list-group-item noboarder-td">
                                Class by scheme: {{ scheme_determined_class }}
                            </li>
                            <li class="list-group-item noboarder-td">
                                Scheme: {{ selected_scheme.display_name }}
                            </li>
                        </ul>
                    </td>
                </tr>

                {% if selected_criteria is not none %}
                <tr>
                    <td class="li-label width_very_small vertical_align_middle" >Criteria</td>
                    <td class="vertical_align_middle">{{ draw_criteria_display(selected_criteria, source='consensus') }}</td>
                </tr>
                {% endif %}

                {% if most_recent_consensus_classification.literature is not none %}
                <tr>
                    <td class="li-label width_very_small vertical_align_middle">Literature</td>
                    <td class="vertical_align_middle">
                        {{ selected_literature_display(most_recent_consensus_classification.literature) }}
                    </td>
                </tr>
                {% endif %}

            </tbody>        
        </table>
    </div>
{% else %}
    <div class="classification-gradient left-space-padding" name="consensus_class_display" classification="-">
        <div class="li-label padding_big">
            <div class="color_black">There is no consensus classification for this variant, yet.</div> 
        </div>
    </div>
{% endif %}

{% endmacro %}



{% macro draw_criteria_display(criteria, source='user') %}
    {% if criteria | length == 0 %}
    <div>None</div>
    {% endif %}
    <div class="d-flex flex-wrap margin_between_list_small">
        {% for criterium in criteria %}
        <div >
            <button class="btn-{{ criterium.type }} light-hover acmg-button acmg-button-small {% if criterium.state == 'unselected' %}crossed{% endif %} text_align_center popover_collapse_toggle"
                    type="button" data-bs-toggle="collapse" data-bs-target=".popover_collapse_toggle:hover + .popover_collapse" aria-expanded="false">
                {{ criterium.display_name() }}
            </button>
            <div class="popover_collapse collapse collapse-horizontal">
                <div class="card card-body width_large">
                    <div class='row gx-2 border-bottom bg-light'>
                        <div class='col-3 text-center'>Type</div>
                        <div class='col-8 text-center border-start'>Info</div>
                    </div>
                    <div class='row gx-2'>
                        <div class='col-3'>State</div>
                        <div class='col-8 text-center border-start'>{{ criterium.state }}</div>
                    </div>
                    <div class='row gx-2'>
                        <div class='col-3'>Strength</div>
                        <div class='col-8 text-center border-start'>{{ criterium.strength }}</div>
                    </div>
                    <div class='row gx-2'>
                        <div class='col-3'>Evidence</div>
                        <div class='col-8 text-center border-start'>{{ criterium.evidence }}</div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
{% endmacro %}



{% macro draw_annotation(annot) %}
{% if annot is not none %}
<div class="break_text_all d-flex margin_between_list_small" annotation_id="{{ annot.id }}">
    <div class="dashed_underline" data-bs-toggle="tooltip" data-bs-title="{{ annot.description }}">{{ annot.display_title }}:</div>
    <div data-testid="annotation-{{annot.title}}">{{ annot.value }}</div>
</div>
{% endif %}
{% endmacro %}

{% macro draw_annotation_group(annotations, current_annotations, group_identifier = '') %}
{% if current_annotations is not none %}
<tr>
    <td class="li-label nowrap">{{ group_identifier }}</td>
    <td>
        {% for annot in current_annotations %}
            <!-- standard single value annotations -->
            {% if annot.draw %}
                {{ draw_annotation(annot) }}
            {% endif %}

            {% if annot.is_transcript_specific %}
            {% set transcripts_sorted, values_sorted = annot.sort() %}
            {% if transcripts_sorted | length > 0 %}

            {% if annot.title == 'pfam_domains' %}
            <div class="d-flex margin_between_list_small" annotation_id="{{ annot.id }}">
                {% set display_transcript = transcripts_sorted[0] %}
                {% set display_parts = values_sorted[0].split(',') %}
                <div class="dashed_underline" data-bs-toggle="tooltip" data-bs-title="{{ annot.description }}">{{ annot.display_title }}:</div>
                <div class="d-flex margin_between_list_small" data-testid="annotation-{{annot.title}}">
                    {% for part in display_parts %}
                        <div>{{ external_link(part, "https://pfam.xfam.org/family/" + part) }}</div>
                    {% endfor %}
                    <div>({{display_transcript}})</div>
                </div>
                <a class="link" tabindex="0" role="button" data-bs-toggle="popover" data-bs-html="true" data-bs-placement="top" data-bs-custom-class="popover_fix_large" data-bs-html="true" 
                    data-bs-content="
                        <div class='row gx-2 border-bottom bg-light width_medium'>
                            <div class='col-6'>Transcript</div>
                            <div class='col-6 text-center border-start'>Pfam Acc. IDs</div>
                        </div>
                        {% for transcript in annot.value %}
                        {% set pfam_accs = annot.value[transcript].split(',') %}
                        <div class='row gx-2 width_medium'>
                            <div class='col-6'>{{transcript}}</div>
                            <div class='col-6 text-center border-start'>
                                {% for pfam_acc in pfam_accs %}
                                    <div><a class='external_link' href='{{'https://pfam.xfam.org/family/' + pfam_acc}}'>{{pfam_acc}}</a></div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                    ">
                    details
                </a>
            </div>
            {% endif %}

            {% if annot.title == 'revel' %}
            {% set max_transcript, max_value = annot.max() %}
            <div class="d-flex margin_between_list_small" annotation_id="{{ annot.id }}">
                <div class="dashed_underline" data-bs-toggle="tooltip" data-bs-title="{{ annot.description }}">{{ annot.display_title }}:</div>
                <div data-testid="annotation-{{annot.title}}">{{max_value}} ({{max_transcript}})</div>
                <a class="link" tabindex="0" role="button" data-bs-toggle="popover" data-bs-html="true" data-bs-placement="top" data-bs-custom-class="popover_fix" data-bs-html="true" data-testid="revel_details"
                    data-bs-content="
                        <div>Overview number shown is the max value from the following table:</div>
                        <div class='row gx-2 border-bottom bg-light width_medium_large'>
                            <div class='col-5'>Transcript</div>
                            <div class='col-7 text-center border-start'>Value</div>
                        </div>
                        {% for i in range(transcripts_sorted | length ) %}
                        {% set current_transcript = transcripts_sorted[i] %}
                        {% set current_value = values_sorted[i] %}
                        <div class='row gx-2 width_medium_large'>
                            <div class='col-5'>{{current_transcript}}</div>
                            <div class='col-7 text-center border-start'>{{current_value}}</div>
                        </div>
                        {% endfor %}
                    ">
                    details
                </a>
            </div>
            {% endif %}
            {% if annot.title == 'maxentscan' %}
            <div class="d-flex margin_between_list_small" annotation_id="{{ annot.id }}">
                {% set transcript = transcripts_sorted[0] %}
                {% set maxent_parts = values_sorted[0].split('|') %}
                <div class="dashed_underline" data-bs-toggle="tooltip" data-bs-title="{{ annot.description }}">{{ annot.display_title }}:</div>
                <div data-testid="annotation-{{annot.title}}">{{ maxent_parts[0] }} -> {{ maxent_parts[1] }} ({{transcript}})</div>
                <a class="link" tabindex="0" role="button" data-bs-toggle="popover" data-bs-html="true" data-bs-placement="top" data-bs-custom-class="popover_fix_large" data-bs-html="true" 
                    data-bs-content="
                        <div>Format of the overview values: ref -> alt.</div>
                        <div class='row gx-2 border-bottom bg-light width_medium'>
                            <div class='col-6'>Transcript</div>
                            <div class='col-3 text-center border-start'>ref</div>
                            <div class='col-3 text-center border-start'>alt</div>
                        </div>
                        {% for transcript in annot.value %}
                        {% set data = annot.value[transcript].split('|') %}
                        <div class='row gx-2 width_medium'>
                            <div class='col-6'>{{transcript}}</div>
                            <div class='col-3 text-center border-start'>{{data[0]}}</div>
                            <div class='col-3 text-center border-start'>{{data[1]}}</div>
                        </div>
                        {% endfor %}
                    ">
                    details
                </a>
            </div>
            {% endif %}
            {% if annot.title == 'maxentscan_swa' %}
            <div class="d-flex margin_between_list_small" annotation_id="{{ annot.id }}">
                {% set transcript = transcripts_sorted[0] %}
                {% set maxent_parts = values_sorted[0].split('|') %}
                <div class="dashed_underline" data-bs-toggle="tooltip" data-bs-title="{{ annot.description }}">{{ annot.display_title }}:</div>
                <div data-testid="annotation-{{annot.title}}">donor: {{ maxent_parts[0] }} -> {{ maxent_parts[1] }} | acceptor: {{ maxent_parts[3] }} -> {{ maxent_parts[4] }} ({{transcript}})</div>
                <a class="link" tabindex="0" role="button" data-bs-toggle="popover" data-bs-html="true" data-bs-placement="top" data-bs-custom-class="popover_fix_large" data-bs-html="true" 
                    data-bs-content="
                        <div>Format of the overview values: ref -> alt.</div>
                        <div class='row gx-2 border-bottom bg-light width_large'>
                            <div class='col-4'>Transcript</div>
                            <div class='col-4 text-center border-start'>donor</div>
                            <div class='col-4 text-center border-start'>acceptor</div>
                        </div>
                        {% for transcript in annot.value %}
                        {% set data = annot.value[transcript].split('|') %}
                        <div class='row gx-2 width_large'>
                            <div class='col-4'>{{transcript}}</div>
                            <div class='col-4 text-center border-start'>
                                <div>ref: {{data[0]}}</div>
                                <div>alt: {{data[1]}}</div>
                                <div>comp: {{data[2]}}</div>
                            </div>
                            <div class='col-4 text-center border-start'>
                                <div>ref: {{data[3]}}</div>
                                <div>alt: {{data[4]}}</div>
                                <div>comp: {{data[5]}}</div>
                            </div>
                        </div>
                        {% endfor %}
                    ">
                    details
                </a>
            </div>
            {% endif %}
            {% endif %}
            {% endif %}

            <!-- special draw annotations -->
            {% if annot.title == 'spliceai_details' %}
                {% set spliceai_details, max_delta_spliceai = annotations.get_spliceai() %}
                <div class="d-flex margin_between_list_small" annotation_id="{{ spliceai_details.id }};{{ max_delta_spliceai.id }}">
                    <div class="dashed_underline" data-bs-toggle="tooltip" data-bs-title="{{ max_delta_spliceai.description }}">{{ spliceai_details.display_title }}:</div>
                    <div class="visually_hidden" data-testid="annotation-{{spliceai_details.title}}">{{ spliceai_details.value }}</div>
                    <div class="visually_hidden" data-testid="annotation-{{max_delta_spliceai.title}}">{{ max_delta_spliceai.value }}</div>
                    <ul class="list-group list-group-horizontal-sm list-nopad-td list-nobackground" >
                        {% set max_spliceai_scores = max_delta_spliceai.value.split(',') %}
                        {% set spliceai_detail_scores = spliceai_details.value.split(',') %}
                        {% for i in range(spliceai_detail_scores | length) %}
                        {% set current_max_value = max_spliceai_scores[i] %}
                        {% set current_spliceai_score = spliceai_detail_scores[i] %}
                        <li class="list-group-item noboarder-td" >
                            <div class="d-flex">
                                <div class="ssr">{{ current_spliceai_score.split('|')[0] }}:</div> <div class="ssr">{{ current_max_value }}</div>
                                <a class="link" tabindex="0" role="button" data-bs-toggle="popover" data-bs-html="true"
                                    data-bs-content="{{ spliceai_details.description }} <br/> {{ current_spliceai_score }}">
                                        details
                                </a>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}

            <!-- Hexplorer -->
            {% if annot.title == 'hexplorer' %} <!-- details for hexplorer score -->
                {% set delta, wt, mut = annotations.get_hexplorer() %}
                {{ draw_hexplorer_score(delta, wt, mut) }}
            {% endif %}
            {% if annot.title == 'hexplorer_rev' %} <!-- details for hexplorer reverse score -->
                {% set delta, wt, mut = annotations.get_hexplorer_rev() %}
                {{ draw_hexplorer_score(delta, wt, mut) }}
            {% endif %}
            {% if annot.title == 'max_hbond' %} <!-- details for hbond score -->
                {% set delta, wt, mut = annotations.get_max_hbond() %}
                {{ draw_hexplorer_score(delta, wt, mut) }}
            {% endif %}
            {% if annot.title == 'max_hbond_rev' %} <!-- details for hbond reverse score -->
                {% set delta, wt, mut = annotations.get_max_hbond_rev() %}
                {{ draw_hexplorer_score(delta, wt, mut) }}
            {% endif %}
        {% endfor %}
    </td>
</tr>
{% endif %}
{% endmacro %}


{% macro draw_hexplorer_score(delta, wt, mut) %}
<div class="break_text_all d-flex margin_between_list_small" annotation_id="{{ delta.id }}{% if wt is not none %};{{ wt.id }}{% endif %}{% if mut is not none %};{{ mut.id }}{% endif %}">
    {% if wt is none or mut is none %}
        {{ draw_exclamation_mark('There is no wildtype or mutant score. Thus, one of the sequences is missing the motiv! Be careful with the interpretation of the delta score!') }}
    {% endif %}
    <div class="dashed_underline" data-bs-toggle="tooltip" data-bs-title="{{ delta.description }}">{{ delta.display_title }}:</div>
    <div data-testid="annotation-{{delta.title}}">{{ delta.value }}</div>
    <div class="visually-hidden" data-testid="annotation-{{wt.title}}">{{ wt.value }}</div>
    <div class="visually-hidden" data-testid="annotation-{{mut.title}}">{{ mut.value }}</div>
    <a class="link" tabindex="0" data-bs-html="true" role="button" data-bs-toggle="popover" data-bs-title="reference score: {% if wt is not none %}{{ wt.value }}{% else %}-{% endif %} <br/> mutant score: {% if mut is not none %}{{ mut.value }}{% else %}-{% endif %}">details</a>
</div>
{% endmacro %}


{% macro draw_heredicare_annotations(variant) %}
{% if variant.heredicare_annotations | length > 0 %}
<tr>
    <td class="li-label nowrap">HerediCare</td>
    <td>
        {% set heredicare_annotations = variant.heredicare_annotations %}
        {% set total_n_fam, total_n_pat = variant.get_total_heredicare_counts() %}
        {% set best_lr_cooc, best_lr_coseg, best_lr_family = variant.get_best_lr_scores() %}
        {% set is_exm = False %}
        {% if heredicare_annotations | length > 1 %}
            {% set is_exm = True %}
        {% endif %}
        {{ draw_heredicare_annotation_worker(heredicare_annotations, "n_fam", total_n_fam, "The number of families in HerediCare reported to have this variant", is_exm) }}
        {{ draw_heredicare_annotation_worker(heredicare_annotations, "n_pat", total_n_pat, "The number of cases in HerediCare reported to have this variant", is_exm) }}
        {{ draw_heredicare_annotation_worker(heredicare_annotations, "lr_cooc", best_lr_cooc, "The likelihood ratio imported from HerediCaRe based on co-occurance", False) }}
        {{ draw_heredicare_annotation_worker(heredicare_annotations, "lr_coseg", best_lr_coseg, "The likelihood ratio imported from HerediCaRe based on cosegregation", False) }}
        {{ draw_heredicare_annotation_worker(heredicare_annotations, "lr_family", best_lr_family, "The likelihood ratio imported from HerediCaRe based on family counts", False) }}
    </td>
</tr>
{% endif %}
{% endmacro %}


{% macro draw_heredicare_annotation_worker(heredicare_annotations, field_name, display_value, tooltip, is_exm) %}
{% if display_value is not none %}
<div class="d-flex margin_between_list_small">
    {% if is_exm %}
        {{ draw_exclamation_mark('Multiple VIDs in HerediCare for this variant. Thus, these counts might be inaccurate!') }}
    {% endif %}
    <div class="dashed_underline" data-bs-toggle="tooltip" data-bs-title="{{ tooltip }}">{{ field_name }}:</div>
    <div data-testid="annotation-{{field_name}}">{{ display_value }}</div>
    <a class="link" tabindex="0" role="button" data-bs-toggle="popover" data-bs-html="true" data-bs-placement="top" data-bs-custom-class="popover_fix" data-bs-html="true" 
    data-bs-content="
        <div class='row gx-2 border-bottom bg-light width_very_medium'>
            <div class='col-7'>HerediCare VID</div>
            <div class='col-4 text-center border-start'>{{field_name}}</div>
        </div>
        {% for annot in heredicare_annotations %}
        <div class='row gx-2 width_very_medium'>
            <div class='col-7'>{{annot.vid}}</div>
            <div class='col-4 text-center border-start'>{{annot.__getattribute__(field_name)}}</div>
        </div>
        {% endfor %}
    ">
        details
    </a>
</div>
{% endif %}
{% endmacro %}

{% macro draw_cancerhotspots_annotation(variant) %}
{% if variant.cancerhotspots_annotations is not none and variant.cancerhotspots_annotations | length > 0 %}
<tr>
    <td class="li-label nowrap">Cancerhotspots</td>
    <td>
        {{ draw_annotation(variant.annotations.cancerhotspots_ac) }}
        {{ draw_annotation(variant.annotations.cancerhotspots_af) }}
        <div class="table-responsive tableFixHead">
            <table class="table table-hover" style="max-height:15em" id="cancerhotspots_table">
                <thead>
                    <tr>
                        <th class="width_very_small bg-light nopad"><div class="sortable">oncotree symbol</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                        <th class="width_medium bg-light nopad" id="cancerhotspots_cancertype_col" asc="false"><div class="sortable">cancertype</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                        <th class="width_small bg-light nopad"><div class="sortable">tissue</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                        <th class="width_very_small bg-light nopad"><div class="sortable"># occurances</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for annot in variant.cancerhotspots_annotations %}
                        <tr annotation_id="{{ annot.id }}">
                            <td data-testid="cancerhotspots">{{ annot.oncotree_symbol }}</td>
                            <td data-testid="cancerhotspots">{{ annot.value }}</td>
                            <td data-testid="cancerhotspots">{{ annot.tissue }}</td>
                            <td data-testid="cancerhotspots">{{ annot.occurances }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </td>
</tr>
{% endif %}
{% endmacro %}


{% macro draw_transcript_annotation(annot) %}
{% if annot is not none %}
<div class="d-flex">
    <abbr class="ssr" title="{{ annot.display_title }}"><a class="dashed_underline">{{ annot.display_title }}:</a></abbr>
    <ul class="list-group list-group-horizontal-sm list-nopad-td list-nobackground" >
        {% for transcript in annot.value %}
        <li class="list-group-item noboarder-td" >
            <div class="d-flex">
                <div class="ssr">{{ annot.value[transcript] }}</div>
                <a class="link" tabindex="0" role="button" data-bs-toggle="popover" data-bs-html="true"
                    data-bs-content="Transcript: {{ transcript }}">
                        details
                </a>
            </div>
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}
{% endmacro %}


{% macro draw_paginated_variant_table(pagination, variants, static_information) %} <!--sort_bys, page_sizes, allowed_user_classes, allowed_consensus_classes, allowed_automatic_classes, annotation_types, allowed_variant_types, lists=none-->
<div id="tabnav-head" class="row align-items-end  nsl nsr">
    <div class="col nopad">{{ pagination.links }}</div>

    <div class="col nopad">
        
        <a class="btn btn-sm btn-primary float_right" data-bs-toggle="collapse" id="searchOptionsToggle" href="#advanced_search" role="button" aria-expanded="false" aria-controls="advanced_search" >
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
            </svg>
        </a>
        

        <a class="btn btn-sm btn-danger float_right" href="{{ url_for(request.url_rule.endpoint) }}" data-bs-toggle="tooltip" title="Clear all filters.">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                
                <g transform="scale(1.5)">
                    <g transform="translate(-4,-2.5)">
                        <path d="M13.854 2.146a.5.5 0 0 1 0 .708l-11 11a.5.5 0 0 1-.708-.708l11-11a.5.5 0 0 1 .708 0Z"/>
                    </g>
                </g>
            </svg>
        </a>
    </div>

    <div class="collapse nopad" id="advanced_search">
        <div class="card card-body">

            <div>
                <form action="" method="GET" novalidate>

                    <div class="form-group">
                        <label for="variants" class="form-label">Variants</label>
                        <textarea type="text" name="variants" id="variants"
                               placeholder="chr16-23608020-C-T; chr17-43045752-43045852-DUP; ...." class="form-control height_zero"
                               >{{ request.args.get('variants', '') }}</textarea>
                    </div>

                    <div class="form-group sst">
                        {% set selected_variant_types = request.args.getlist('variant_type') %}
                        <label for="variant_type-select" class="form-label">Variant types</label>
                        <div id="variant_type-select" class="d-flex">
                            {% for variant_type in static_information['allowed_variant_types'] %}
                                <div class="form-check d-flex bsr align-items-center">
                                    <input class="form-check-input ssr" type="checkbox" value="{{variant_type}}" id="variant_type_{{variant_type}}" name="variant_type" {% if variant_type in selected_variant_types or selected_variant_types | length == 0 %}checked{% endif %}>
                                    <label class="form-check-label" for="variant_type_{{variant_type}}">{{variant_type.replace('_', ' ')}}</label>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
        
                    <div class="form-group sst">
                        <label for="genes" class="form-label">Genes</label>
                        <textarea type="text" name="genes" id="genes"
                               placeholder="BRCA1; BARD1; ..." class="form-control height_zero"
                               >{{ request.args.get('genes', '') }}</textarea>
                    </div>
        
                    <div class="form-group sst">
                        <label for="ranges" class="form-label">Ranges</label>
                        <textarea type="text" name="ranges" id="ranges"
                               placeholder="chr1:10295758-17027834; chr11:108229378-108229378; ..." class="form-control height_zero"
                               >{{ request.args.get('ranges', '') }}</textarea>
                        
                        <div class="d-flex"> <!-- custom file upload -->
                            <input class="btn btn-secondary fake-upload-button" type="button" id="loadbed" value="select bed..." />
                            <label class="form-control fake-upload-label cursor_pointer" for="loadbed" id="filepath_display">No file selected.</label>
                            <input type="file" name="bed" class="form-control visually-hidden" id="bed" accept=".bed"></input>
                        </div>

                        <div id="status"></div>
                    </div>

                    <div class="form-group sst">
                        <label for="cdna_ranges" class="form-label">cDNA ranges</label>
                        <textarea type="text" name="cdna_ranges" id="cdna_ranges"
                               placeholder="ENST00000141510 1234-12 4567; TP53 1234+3 4567+3" class="form-control height_zero"
                               >{{ request.args.get('cdna_ranges', '') }}</textarea>
                    </div>

                    <div class="form-group sst">
                        <label for="hgvs" class="form-label">HGVS c.</label>
                        <textarea type="text" name="hgvs" id="hgvs"
                               placeholder="ENST00000260947:c.1972C>T; ..." class="form-control height_zero"
                               >{{ request.args.get('hgvs', '') }}</textarea>
                    </div>

                    <div class="form-group sst">
                        <label for="external_ids" class="form-label">IDs</label>
                        <textarea type="text" name="external_ids" id="external_ids"
                               placeholder="COSV99639284; rs9217747; 35110:heredivar; ..." class="form-control height_zero"
                               >{{ request.args.get('external_ids', '') }}</textarea>
                    </div>

                    <div class="form-group sst">
                        <label class="form-label">Annotations</label>
                        <div id="annotation_wrapper">

                        </div>
                        <button class="btn btn-primary" type="button" id="add_annotation_select">+</button>
                    </div>

                    <div class="form-group sst">
                        {% set selected_consensus = request.args.getlist('consensus') %}
                        <label for="consensus-select" class="form-label">Consensus classification</label>
                        <div id="consensus-select" class="d-flex">
                            {% for c in static_information['allowed_consensus_classes'] %}
                                <div class="form-check d-flex bsr align-items-center">
                                    <input class="form-check-input ssr" type="checkbox" value="{{c}}" id="cl{{c}}" data-testid="cl{{c.replace('+', 'p')}}" name="consensus" {% if c in selected_consensus %}checked{% endif %}>
                                    <label class="form-check-label" for="cl{{c}}">{{c}}</label>
                                </div>
                            {% endfor %}
                            <div class="form-check d-flex bsr align-items-center">
                                <input class="form-check-input ssr" type="checkbox" value="-" id="cl-" data-testid="cl-" name="consensus" {% if '-' in selected_consensus %}checked{% endif %}>
                                <label class="form-check-label" for="cl-">none</label>
                            </div>
                            <div class="form-check d-flex align-items-center">
                                <input class="form-check-input ssr" type="checkbox" value="on" id="include_heredicare_consensus" data-testid="include_heredicare_consensus" name="include_heredicare_consensus" {% if request.args.get('include_heredicare_consensus') == 'on' %}checked{% endif %}>
                                <label class="form-check-label" for="include_heredicare_consensus">include_heredicare</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group sst">
                        {% set selected_user = request.args.getlist('user') %}
                        <label for="user-select" class="form-label">Your classification</label>
                        <div id="user-select" class="d-flex">
                            {% for c in static_information['allowed_user_classes'] %}
                                <div class="form-check d-flex bsr align-items-center">
                                    <input class="form-check-input ssr" type="checkbox" value="{{c}}" id="ucl{{c}}" data-testid="ucl{{c.replace('+', 'p')}}" name="user" {% if c in selected_user %}checked{% endif %}>
                                    <label class="form-check-label" for="ucl{{c}}">{{c}}</label>
                                </div>
                            {% endfor %}
                            <div class="form-check d-flex align-items-center">
                                <input class="form-check-input ssr" type="checkbox" value="-" id="ucl-" data-testid="ucl-" name="user" {% if '-' in selected_user %}checked{% endif %}>
                                <label class="form-check-label" for="ucl-">none</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group sst">
                        <label for="user-select" class="form-label">Automatic classification</label>
                        <table class="table table-borderless table-slim">
                            <tbody>
                                <tr>
                                    <td class="nopad"><div>Splicing:</div></td>
                                    <td>
                                        <div id="user-select" class="d-flex">
                                            {% set selected_automatic = request.args.getlist('automatic_splicing') %}
                                            {% for c in static_information['allowed_automatic_classes'] %}
                                                <div class="form-check d-flex bsr align-items-center">
                                                    <input class="form-check-input ssr" type="checkbox" value="{{c}}" id="acls{{c}}" data-testid="acls{{c.replace('+', 'p')}}" name="automatic_splicing" {% if c in selected_automatic %}checked{% endif %}>
                                                    <label class="form-check-label" for="acls{{c}}">{{c}}</label>
                                                </div>
                                            {% endfor %}
                                            <div class="form-check d-flex align-items-center">
                                                <input class="form-check-input ssr" type="checkbox" value="-" id="acls-" data-testid="acls-" name="automatic_splicing" {% if '-' in selected_automatic %}checked{% endif %}>
                                                <label class="form-check-label" for="acls-">none</label>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="nopad"><div>Protein:</div></td>
                                    <td>
                                        <div id="user-select" class="d-flex">
                                            {% set selected_automatic = request.args.getlist('automatic_protein') %}
                                            {% for c in static_information['allowed_automatic_classes'] %}
                                                <div class="form-check d-flex bsr align-items-center">
                                                    <input class="form-check-input ssr" type="checkbox" value="{{c}}" id="aclp{{c}}" data-testid="aclp{{c.replace('+', 'p')}}" name="automatic_protein" {% if c in selected_automatic %}checked{% endif %}>
                                                    <label class="form-check-label" for="aclp{{c}}">{{c}}</label>
                                                </div>
                                            {% endfor %}
                                            <div class="form-check d-flex align-items-center">
                                                <input class="form-check-input ssr" type="checkbox" value="-" id="aclp-" data-testid="aclp-" name="automatic_protein" {% if '-' in selected_automatic %}checked{% endif %}>
                                                <label class="form-check-label" for="aclp-">none</label>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>


                    </div>

                    {% if static_information['lists'] is not none %}
                    <div class="form-group sst">
                        <label for="lookup_list_name" class="form-label">List</label>
                        <div id="select_list_wrapper"></div>
                        <button class="btn btn-primary" type="button" id="add_list_select">+</button>
                    </div>
                    {% endif %}

                    
                    <div class="form-group d-flex sst">
                        <div class="bsr">
                            <label for="page_size" class="form-label">Page size</label>
                            <select class="form-select width_very_small" name="page_size" id="page_size" required>
                                {% set selected_page_size = request.args.get('page_size', static_information['default_page_size']) %}
                                {% for option in static_information['page_sizes'] %}
                                    <option value="{{option}}" {% if selected_page_size == option %} selected="selected" {% endif %}> {{option}} </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="bsr">
                            <label for="sort_by" class="form-label">Sort by</label>
                            <select class="form-select width_small" name="sort_by" id="sort_by" required>
                                {% set selected_sort_by = request.args.get('sort_by', static_information['default_search_by']) %}
                                {% for option in static_information['sort_bys'] %}
                                    <option value="{{option}}" {% if selected_sort_by == option %} selected="selected" {% endif %}> {{option}} </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="status-select" class="form-label">Status</label>
                            <div id="status-select" class="d-flex">
                                <div class="form-check d-flex bsr align-items-center">
                                    <input class="form-check-input vssr" type="checkbox" id="include_hidden" name="include_hidden" {% if request.args.get('include_hidden') == 'on' %}checked{% endif %}>
                                    <label class="form-check-label" for="include_hidden">Include hidden</label>
                                </div>
                            </div>
                        </div>
                    
                    </div>


                    {% if request.args.get('view') is not none %}
                        <input type="hidden" name="view" id="view" value="{{request.args.get('view')}}">
                    {% endif %}
                    
        
                    <div class="d-flex justify-content-end align-items-center">
                        <div>
                            <a class="ssr float_right" href="{{url_for('main.documentation')}}">Help</a>
                        </div>
                        <button id="submit_search" class="btn btn-primary float_right" type="submit">search</button>
                    </div>
        
                </form>
            </div>
        
        </div>
    </div>
</div>
  
  
<div class="table-responsive tableFixHead table-100 ">
  <table class="table table-hover ssb" id="variantTable">
    <thead id="variantTableHead">
      <tr>
        <th class="visually_hidden">id</th>
        <th class="text_align_center width_minimal">CHROM</th>
        <th class="width_very_medium">POS</th>
        <th class="width_very_medium">REF</th>
        <th class="width_very_medium">ALT</th>
        <th class="width_very_small">VARTYPE</th>
        <th class="width_small">HGVS c.</th>
        <th class="width_small">HGVS p.</th>
        <th class="width_very_small">GENE</th>
        <th class="text_align_center width_small">Automatic classification</th>
        <th class="text_align_center width_small">Your classification</th>
        <th class="text_align_center width_small">Consensus classification</th>
      </tr>
    </thead>
    <tbody id="variantTableBody">
      {% for variant in variants %}
      {% set preferred_transcripts = variant.get_preferred_transcripts() %}
      <tr name="variant_row" {% if variant.is_hidden %}class="bg_hidden_variant"{% endif %} variant_id="{{ variant.id }}">
        <td class="visually_hidden">{{ variant.id }}</td>
        <td data-href="{{ url_for('variant.display', variant_id=variant.id) }}" class="text_align_center clickable nowrap">{{ variant.chrom }}</td>
        <td data-href="{{ url_for('variant.display', variant_id=variant.id) }}" class="clickable nowrap">
            {% if variant.imprecise %}{{draw_exclamation_mark(variant.variant_type + " variant with imprecise position!")}}{% endif %}
            {% if variant.variant_type == 'sv' and variant.alt[0] == '<' %}
                {{ variant.start }} - {{ variant.end }}
            {% else %}
                {{ variant.pos }}
            {% endif %}
        </td>
        <td data-href="{{ url_for('variant.display', variant_id=variant.id) }}" class="clickable longTextCss">
            <div class="fit_content Nellipsis" data-bs-toggle="tooltip" data-bs-title="{{ variant.ref }}">{{ variant.ref }}</div>
        </td>
        <td data-href="{{ url_for('variant.display', variant_id=variant.id) }}" class="clickable longTextCss">
            <div class="fit_content Nellipsis" data-bs-toggle="tooltip" data-bs-title="{{ variant.alt }}">{{ variant.alt }}</div>
        </td>
        <td data-href="{{ url_for('variant.display', variant_id=variant.id) }}" class="clickable">
            {% if variant.variant_type == 'sv' %}
                {{ variant.variant_type }}:{{ variant.sv_type }}
            {% else %}
                {{ variant.variant_type }}
            {% endif %}
        </td>
        <td data-href="{{ url_for('variant.display', variant_id=variant.id) }}" class="clickable longTextCss nowrap">
            {% if variant.variant_type == 'sv' %}
                {% set all_custom_hgvs = variant.get_custom_hgvs(hgvs_type = 'c') %}
                {% if all_custom_hgvs | length > 0 %}
                    {% for custom_hgvs in all_custom_hgvs %}
                        <div class="fit_content Nellipsis" data-bs-toggle="tooltip" data-bs-title="{{ custom_hgvs.hgvs }}">{{ custom_hgvs.hgvs }}</div>
                    {% endfor %}
                {% else %}
                    <div class="fit_content" data-bs-toggle="tooltip" data-bs-title="-">-</div>
                {% endif %}
            {% else %}
                {% if preferred_transcripts is not none %}
                    {% for consequence in preferred_transcripts %}
                        {% if consequence.hgvs_c is not none %} {% set hgvs_c = consequence.hgvs_c %} {% else %} {% set hgvs_c = '-' %} {% endif %}
                        <div class="fit_content Nellipsis" data-bs-toggle="tooltip" data-bs-title="{{ hgvs_c }}">{{ hgvs_c }}</div>
                    {% endfor %}
                {% else %}
                    <div class="fit_content" data-bs-toggle="tooltip" data-bs-title="-">-</div>
                {% endif %}
            {% endif %}
        </td>
        <td data-href="{{ url_for('variant.display', variant_id=variant.id) }}" class="clickable longTextCss nowrap">
            {% if variant.variant_type == 'sv' %}
                {% set all_custom_hgvs = variant.get_custom_hgvs(hgvs_type = 'p') %}
                {% if all_custom_hgvs | length > 0 %}
                    {% for custom_hgvs in all_custom_hgvs %}
                        <div class="fit_content Nellipsis" data-bs-toggle="tooltip" data-bs-title="{{ custom_hgvs.hgvs }}">{{ custom_hgvs.hgvs }}</div>
                    {% endfor %}
                {% else %}
                    <div class="fit_content" data-bs-toggle="tooltip" data-bs-title="-">-</div>
                {% endif %}
            {% else %}
                {% if preferred_transcripts is not none %}
                    {% for consequence in preferred_transcripts %}
                        {% if consequence.hgvs_p is not none %} {% set hgvs_p = consequence.hgvs_p %} {% else %} {% set hgvs_p = '-' %} {% endif %}
                            <div class="fit_content Nellipsis" data-bs-toggle="tooltip" data-bs-title="{{ hgvs_p }}">{{ hgvs_p }}</div>
                    {% endfor %}
                {% else %}
                        <div class="fit_content" data-bs-toggle="tooltip" data-bs-title="-">-</div>
                {% endif %}
            {% endif %}
        </td>
        <td class="clickable" data-href="{{ url_for('variant.display', variant_id=variant.id) }}">
            {% if variant.variant_type == 'sv' %}
                {% set breakpoint_genes = variant.get_breakpoint_genes() %}
                {% if breakpoint_genes | length > 0 %}
                        {% for overlapping_gene in breakpoint_genes %}
                        <div>
                            <a href="{{ url_for('extended_information.gene', gene_id=overlapping_gene[0] | int) }}">{{ overlapping_gene[1] }}</a>
                        </div>
                    {% endfor %}
                {% else %}
                    <div>-</div>
                {% endif %}
            {% else %}
                {% if preferred_transcripts is not none %}
                    {% for consequence in preferred_transcripts %}
                        {% if consequence.transcript.gene is not none %} 
                            {% if consequence.transcript.gene.symbol is not none %} {% set gene_symbol = consequence.transcript.gene.symbol %} {% else %} {% set gene_symbol = '-' %} {% endif %}
                            <div>
                                <a href="{{ url_for('extended_information.gene', gene_id=consequence.transcript.gene.id | int) }}">{{ gene_symbol }}</a>
                            </div>
                        {% else %}
                            <div>-</div>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <div>-</div>
                {% endif %}
            {% endif %}

        </td>
        <td class="text_align_center clickable" data-href="{{ url_for('variant.display', variant_id=variant.id) }}">
            {% set automatic_classification = variant.automatic_classification %}
            s: {% if automatic_classification is not none %}{{ automatic_classification.classification_splicing }}{% else %}-{% endif %} / p: {% if automatic_classification is not none %}{{ automatic_classification.classification_protein }}{% else %}-{% endif %}
        </td>
        <td class="text_align_center clickable" data-href="{{ url_for('variant.display', variant_id=variant.id) }}">
            {% set your_classification = variant.get_recent_user_classification(session['user']['user_id']) %}
            {% if your_classification is not none %} {{ your_classification.selected_class }} {% else %}-{%endif%}
        </td>
        <!--<td style="text-align:center;">{% if variant[7] is not none %} {{ variant[7] }} {% else %}-{%endif%}</td>-->
        <td class="text_align_center clickable" data-href="{{ url_for('variant.display', variant_id=variant.id) }}">
            {% set _consensus_class, _source = variant.get_consensus_class() %}
            {{ render_consensus_classification_label(_consensus_class, _source, '2em') }}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="tabnav-bottom" class="ssb">{{ pagination.links }}</div>

<input type='hidden' id='flask_data' 
    data-lists='{{ static_information["lists"] | tojson | safe}}'
    data-list-names='{{ request.args.getlist("lookup_list_name") | tojson }}'
    data-list-ids='{{ request.args.getlist("lookup_list_id") | tojson}}'
    data-previous-selected-variants='{{ request.args.get("selected_variants", "") }}'
    data-select-all-variants='{{ request.args.get("select_all_variants", "false") }}'
    data-annotation-types='{{ static_information["annotation_types"] | tojson | safe }}'
    data-selected-annotation-type-ids='{{ request.args.getlist("annotation_type_id") | tojson }}'
    data-selected-annotation-operations='{{ request.args.getlist("annotation_operation") | tojson }}'
    data-selected-annotation-values='{{ request.args.getlist("annotation_value") | tojson }}'
/>
<script src="/static/js/paginated_variants.js"></script>



{% endmacro %}


{% macro draw_consequence_table(variant) %}
<ul class="nav nav-tabs" id="tabs" role="tablist"> <!-- although this uses the styles from a tablist it is essentially not a tablist as it is not linked to the tabContent div below! Changes appear through javascript-->
    <li class="nav-item" role="presentation">
        <button id="consequence_ensembl_tab" class="nav-link active" data-bs-toggle="tab" type="button" role="tab" aria-selected="true">Ensembl</button>
    </li>
    <li class="nav-item" role="presentation">
        <button id="consequence_refseq_tab" class="nav-link" data-bs-toggle="tab" type="button" role="tab" aria-selected="false">RefSeq</button>
    </li>
</ul>
<div class="tab-content" id="tabContent">

    <div class="table-responsive tableFixHead table-lg">
        <table class="table table-hover" id="variantConsequenceTable">
            <thead>
                <tr>
                    <th class="width_small"><div class="sortable">Transcript Name</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                    <th class="width_small"><div class="sortable">HGVS_C</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                    <th class="width_small"><div class="sortable">HGVS_P</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                    <th class="width_medium"><div class="sortable">Consequence</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                    <th class="width_small"><div class="sortable">Impact</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                    <th class="width_very_small"><div class="sortable">Exon Nr.</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                    <th class="width_very_small"><div class="sortable">Int. Nr.</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                    <th class="width_very_small" id="variant_consequence_gene_symbol_col" asc="false"><div class="sortable">Gene</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>
                    <th class="width_very_medium"><div class="sortable">Flags</div><input type="text" class="form-control form-control-sm column-filter sst" placeholder="search..." autocomplete="off"></th>

                    <th class="visually_hidden" id="variant_consequence_source_col">Source</th>
                    <th class="width_very_small" id="variant_consequence_length_col" asc="true"><div class="sortable">Length</div></th>
                    <th class="visually_hidden" id="variant_consequence_numflags_col" asc="true">NumFlags</th>
                    <th class="width_small">Links</th>
                </tr>
            </thead>
            <tbody>
                {% if variant.consequences is not none %}
                {% for consequence in variant.consequences %}
                <tr>
                    <td class="nowrap">{{ consequence.transcript.name }}</td>
                    <td class="nowrap">{{ consequence.hgvs_c }}</td>
                    <td class="nowrap">{{ consequence.hgvs_p }}</td>
                    <td>{{ consequence.consequence }}</td>
                    <td>{{ consequence.impact }}</td>
                    <td>{{ consequence.exon }}</td>
                    <td>{{ consequence.intron }}</td>
                    <td>
                        {% if consequence.transcript.gene.id is not none %}
                            <a href="{{ url_for('extended_information.gene', gene_id=consequence.transcript.gene.id | int) }}">{{ consequence.transcript.gene.symbol }}</a>
                        {% else %}
                            {{ consequence.transcript.gene.symbol }}
                        {% endif %}
                    </td>
                    <td>
                        {% if consequence.transcript.is_gencode_basic %}
                            <span class="badge bg-secondary"><abbr title="This flag describes a subset of representative transcripts of the GENCODE set of genes.">GENCODE basic</abbr></span>
                        {% endif %}
                        {% if consequence.transcript.is_mane_select %}
                            <span class="badge bg-secondary"><abbr title="Each MANE (Matched Annotation from the NCBI and EMBL-EBI) transcript represents an exact match in exonic regions between a Refseq transcript and its counterpart in the Ensembl/GENCODE. The MANE Select set consists of one transcript at each protein-coding locus across the genome that is representative of biology at that locus. This set is useful as a universal standard for clinical reporting. MANE Select transcripts are identified using computational methods complemented by manual review and discussion.">MANE select</abbr></span>
                        {% endif %}
                        {% if consequence.transcript.is_mane_plus_clinical %}
                            <span class="badge bg-secondary"><abbr title="Each MANE (Matched Annotation from the NCBI and EMBL-EBI) transcript represents an exact match in exonic regions between a Refseq transcript and its counterpart in the Ensembl/GENCODE. The MANE Plus Clinical set includes additional transcripts for genes where MANE Select alone is not sufficient to report all pathogenic or likely pathogenic clinical variants available in public resources.">MANE clin</abbr></span>
                        {% endif %}
                        {% if consequence.transcript.is_ensembl_canonical %}
                            <span class="badge bg-secondary"><abbr title="The Ensembl Canonical transcript is a single, representative transcript identified at every locus using different transcript-traits like the highest coverage of conserved exons, highest expression, longest coding sequence and is represented in other key resources, such as NCBI and UniProt.">ensembl canonical</abbr></span>
                        {% endif %}
                    </td>

                    <td class="visually_hidden">{{ consequence.transcript.source }}</td>
                    <td >{{ consequence.transcript.length }}</td>
                    <td class="visually_hidden">{{ consequence.get_num_flags() }}</td>

                    <td>
                        {% set rsids = variant.get_external_ids('rsid') %}
                        {% set rsid = none %}
                        {% if rsids | length > 0 %}
                            {% set rsid = rsids[0].value %}
                        {% endif %}
                        
                        <div class="d-flex">
                            <div class="ssr">
                                {{ google_link("google", rsid = rsid, hgvs_c = consequence.hgvs_c, hgvs_p = consequence.hgvs_p, gene_symbol = consequence.transcript.gene.symbol, is_scholar = False) }}
                            </div>
                            <div class="ssr">
                                {{ google_link("scholar", rsid = rsid, hgvs_c = consequence.hgvs_c, hgvs_p = consequence.hgvs_p, gene_symbol = consequence.transcript.gene.symbol, is_scholar = True) }}
                            </div>
                            {% if consequence.transcript.gene.symbol in ['MLH1', 'MSH2', 'MSH6', 'PMS2'] %}
                            <div>
                                {{ external_link("InSiGHT", "http://www.insight-database.org/classifications/index.html?gene=" + consequence.transcript.gene.symbol + "&variant=" + consequence.hgvs_c | replace('>', '%3E')) }}
                            </div>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
                {% endif %}
            </tbody>
        </table>
    </div>

</div>
{% endmacro %}







{% macro draw_exclamation_mark(tooltip) %}
<span class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" title="{{tooltip}}">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-exclamation-triangle-fill" viewBox="0 0 16 16">
        <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
    </svg>
</span>
{% endmacro %}



{% macro draw_private_symbol(tooltip) %}
<span class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" title="{{tooltip}}">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
        <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
        <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
    </svg>
    <div class="visually_hidden">private</div> <!-- make the search bar work when this is in a table -->
</span>
{% endmacro %}


{% macro draw_public_symbol(tooltip) %}
<span class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" title="{{tooltip}}">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-globe2" viewBox="0 0 16 16">
        <path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855-.143.268-.276.56-.395.872.705.157 1.472.257 2.282.287V1.077zM4.249 3.539c.142-.384.304-.744.481-1.078a6.7 6.7 0 0 1 .597-.933A7.01 7.01 0 0 0 3.051 3.05c.362.184.763.349 1.198.49zM3.509 7.5c.036-1.07.188-2.087.436-3.008a9.124 9.124 0 0 1-1.565-.667A6.964 6.964 0 0 0 1.018 7.5h2.49zm1.4-2.741a12.344 12.344 0 0 0-.4 2.741H7.5V5.091c-.91-.03-1.783-.145-2.591-.332zM8.5 5.09V7.5h2.99a12.342 12.342 0 0 0-.399-2.741c-.808.187-1.681.301-2.591.332zM4.51 8.5c.035.987.176 1.914.399 2.741A13.612 13.612 0 0 1 7.5 10.91V8.5H4.51zm3.99 0v2.409c.91.03 1.783.145 2.591.332.223-.827.364-1.754.4-2.741H8.5zm-3.282 3.696c.12.312.252.604.395.872.552 1.035 1.218 1.65 1.887 1.855V11.91c-.81.03-1.577.13-2.282.287zm.11 2.276a6.696 6.696 0 0 1-.598-.933 8.853 8.853 0 0 1-.481-1.079 8.38 8.38 0 0 0-1.198.49 7.01 7.01 0 0 0 2.276 1.522zm-1.383-2.964A13.36 13.36 0 0 1 3.508 8.5h-2.49a6.963 6.963 0 0 0 1.362 3.675c.47-.258.995-.482 1.565-.667zm6.728 2.964a7.009 7.009 0 0 0 2.275-1.521 8.376 8.376 0 0 0-1.197-.49 8.853 8.853 0 0 1-.481 1.078 6.688 6.688 0 0 1-.597.933zM8.5 11.909v3.014c.67-.204 1.335-.82 1.887-1.855.143-.268.276-.56.395-.872A12.63 12.63 0 0 0 8.5 11.91zm3.555-.401c.57.185 1.095.409 1.565.667A6.963 6.963 0 0 0 14.982 8.5h-2.49a13.36 13.36 0 0 1-.437 3.008zM14.982 7.5a6.963 6.963 0 0 0-1.362-3.675c-.47.258-.995.482-1.565.667.248.92.4 1.938.437 3.008h2.49zM11.27 2.461c.177.334.339.694.482 1.078a8.368 8.368 0 0 0 1.196-.49 7.01 7.01 0 0 0-2.275-1.52c.218.283.418.597.597.932zm-.488 1.343a7.765 7.765 0 0 0-.395-.872C9.835 1.897 9.17 1.282 8.5 1.077V4.09c.81-.03 1.577-.13 2.282-.287z"/>
    </svg>
    <div class="visually_hidden">public</div> <!-- make the search bar work when this is in a table -->
</span>
{% endmacro %}


{% macro draw_duplicate_symbol(tooltip) %}
<span class="d-flex" tabindex="0" data-bs-toggle="tooltip" title="{{tooltip}}">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-layers" viewBox="0 0 16 16">
        <path d="M8.235 1.559a.5.5 0 0 0-.47 0l-7.5 4a.5.5 0 0 0 0 .882L3.188 8 .264 9.559a.5.5 0 0 0 0 .882l7.5 4a.5.5 0 0 0 .47 0l7.5-4a.5.5 0 0 0 0-.882L12.813 8l2.922-1.559a.5.5 0 0 0 0-.882l-7.5-4zm3.515 7.008L14.438 10 8 13.433 1.562 10 4.25 8.567l3.515 1.874a.5.5 0 0 0 .47 0l3.515-1.874zM8 9.433 1.562 6 8 2.567 14.438 6 8 9.433z"/>
    </svg>
</span>
{% endmacro %}

{% macro draw_intersect_symbol(tooltip) %}
<span class="d-flex" tabindex="0" data-bs-toggle="tooltip" title="{{tooltip}}">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-intersect" viewBox="0 0 16 16">
        <path d="M0 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v2h2a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-2H2a2 2 0 0 1-2-2V2zm5 10v2a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2v5a2 2 0 0 1-2 2H5zm6-8V2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h2V6a2 2 0 0 1 2-2h5z"/>
    </svg>
</span>
{% endmacro %}

{% macro draw_subtract_symbol(tooltip) %}
<span class="d-flex" tabindex="0" data-bs-toggle="tooltip" title="{{tooltip}}">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-subtract" viewBox="0 0 16 16">
        <path d="M0 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v2h2a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-2H2a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H2z"/>
    </svg>
</span>
{% endmacro %}


{% macro draw_add_symbol(tooltip) %}
<span class="d-flex" tabindex="0" data-bs-toggle="tooltip" title="{{tooltip}}">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-union" viewBox="0 0 16 16">
        <path d="M0 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v2h2a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-2H2a2 2 0 0 1-2-2V2z"/>
    </svg>
</span>
{% endmacro %}


{% macro draw_gear(tooltip) %}
<span class="d-flex" tabindex="0" data-bs-toggle="tooltip" title="{{tooltip}}">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gear" viewBox="0 0 16 16">
        <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
        <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"/>
    </svg>
</span>
{% endmacro %}

{% macro draw_check_square(tooltip, width=16, height=16) %}
<span class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" title="{{tooltip}}">
    <svg xmlns="http://www.w3.org/2000/svg" width="{{width}}" height="{{height}}" fill="currentColor" class="bi bi-check-square-fill" viewBox="0 0 16 16">
        <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm10.03 4.97a.75.75 0 0 1 .011 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.75.75 0 0 1 1.08-.022z"/>
    </svg>
</span>
{% endmacro %}

{% macro draw_x_square(tooltip, width=16, height=16) %}
<span class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" title="{{tooltip}}">
    <svg xmlns="http://www.w3.org/2000/svg" width="{{width}}" height="{{height}}" fill="currentColor" class="bi bi-x-square-fill" viewBox="0 0 16 16">
        <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm3.354 4.646L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 1 1 .708-.708"/>
    </svg>
</span>
{% endmacro %}

{% macro draw_dash_square(tooltip, width=16, height=16) %}
<span class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" title="{{tooltip}}">
    <svg xmlns="http://www.w3.org/2000/svg" width="{{width}}" height="{{height}}" fill="currentColor" class="bi bi-dash-square-fill" viewBox="0 0 16 16">
        <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm2.5 7.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1"/>
    </svg>
</span>
{% endmacro %}

{% macro draw_square(tooltip, width=16, height=16) %}
<span class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" title="{{tooltip}}">
    <svg xmlns="http://www.w3.org/2000/svg" width="{{width}}" height="{{height}}" fill="currentColor" class="bi bi-square" viewBox="0 0 16 16">
        <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
    </svg>
</span>
{% endmacro %}

{% macro draw_db_down(tooltip, width=16, height=16) %}
<span class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" title="{{tooltip}}">
    <svg xmlns="http://www.w3.org/2000/svg" width="{{width}}" height="{{height}}" fill="currentColor" class="bi bi-database-down" viewBox="0 0 16 16">
        <path d="M12.5 9a3.5 3.5 0 1 1 0 7 3.5 3.5 0 0 1 0-7m.354 5.854 1.5-1.5a.5.5 0 0 0-.708-.708l-.646.647V10.5a.5.5 0 0 0-1 0v2.793l-.646-.647a.5.5 0 0 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0"/>
        <path d="M12.096 6.223A5 5 0 0 0 13 5.698V7c0 .289-.213.654-.753 1.007a4.5 4.5 0 0 1 1.753.25V4c0-1.007-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1s-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4v9c0 1.007.875 1.755 1.904 2.223C4.978 15.71 6.427 16 8 16c.536 0 1.058-.034 1.555-.097a4.5 4.5 0 0 1-.813-.927Q8.378 15 8 15c-1.464 0-2.766-.27-3.682-.687C3.356 13.875 3 13.373 3 13v-1.302c.271.202.58.378.904.525C4.978 12.71 6.427 13 8 13h.027a4.6 4.6 0 0 1 0-1H8c-1.464 0-2.766-.27-3.682-.687C3.356 10.875 3 10.373 3 10V8.698c.271.202.58.378.904.525C4.978 9.71 6.427 10 8 10q.393 0 .774-.024a4.5 4.5 0 0 1 1.102-1.132C9.298 8.944 8.666 9 8 9c-1.464 0-2.766-.27-3.682-.687C3.356 7.875 3 7.373 3 7V5.698c.271.202.58.378.904.525C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777M3 4c0-.374.356-.875 1.318-1.313C5.234 2.271 6.536 2 8 2s2.766.27 3.682.687C12.644 3.125 13 3.627 13 4c0 .374-.356.875-1.318 1.313C10.766 5.729 9.464 6 8 6s-2.766-.27-3.682-.687C3.356 4.875 3 4.373 3 4"/>
    </svg>
</span>
{% endmacro %}



{% macro select_list_modal(lists, href_loc, arguments, display_text) %}

<!-- modal for showing all lists & each list has a customizable link -->
<div class="modal fade" id="list-add-modal" tabindex="-1" aria-labelledby="list-add-modal-label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="list-add-modal-label">Select a list</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
              <div class="modal-body">
                <div class="ssb">
                  {{ display_text }}
                </div>
                  
                <div class="table-responsive tableFixHead" >
                  <table class="table table-hover" id="list-add-table">
                    <thead>
                      <tr>
                        <th class="nopad bg-light width_very_minimal">
                          <div class="sortable"></div><input type="text" class="form-control form-control-sm column-filter" placeholder="search..." autocomplete="off">
                        </th>
                        <th class="nopad bg-light">
                          <div class="sortable"></div><input type="text" class="form-control form-control-sm column-filter" placeholder="search..." autocomplete="off">
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for list in lists %}
                        {% if list[4] == 1 or list[5] == 1 %}

                        <tr>
                            <td class="nopad">
                                <form action="{{ url_for(href_loc, selected_list_id=list[0], **arguments) }}" method="post">
                                    <button class="d-flex justify-content-center dropdown-item {{list[6]}} padding_small submit_from_list_button" type="submit">
                                        {% if list[3] == 1 %} <!-- is public -->
                                            {{ draw_public_symbol("Public list") }}
                                        {% else %} <!-- is private -->
                                            {{ draw_private_symbol("Private list") }}
                                        {% endif %}
                                    </button>
                                </form>
                            </td>
                            <td class="nopad hyphens">
                                <form action="{{ url_for(href_loc, selected_list_id=list[0], **arguments) }}" method="post">
                                    <button class="dropdown-item {{list[6]}} padding_small submit_from_list_button" type="submit">
                                        <div class="wrap-spaces">{{ list[2] }}</div>
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endif %}
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
                
              </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
  </div>
  

{% endmacro %}




{% macro add_variant_banner(variant) %}
<div class="w-100 ssb">
    <div class="card variant-banner-color left-space-padding">
        
        <div class="card-text">
            <div class="table-responsive">
                <table class="table table-borderless table-slim">
                    <tbody>
                        <tr>
                            <td class="width_small li-label">Variant</td>
                            <td > 
                                <div class="break_text_all d-flex align-items-center">

                                    {% if variant.imprecise %} <span class="ssr">{{draw_exclamation_mark(variant.variant_type + " variant with imprecise position!")}}</span> {% endif %}
                                    <span>
                                        {{ variant.get_string_repr() }}
                                    </span>
                                    
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="width_small li-label"><abbr title="One or more strings in the format: gene hgvsc. hgvsp. This shows all 'best' transcripts and prefers mane select.">HGVS</abbr></td>
                            <td>
                                {% if variant.variant_type == 'sv' %}
                                    {% if variant.custom_hgvs | length > 0 %}
                                        <ul class="list-group list-group-horizontal-sm list-nopad-td list-nobackground">
                                            {% for custom_hgvs in variant.custom_hgvs %}
                                            <li class="list-group-item noboarder-td">
                                                <div class="d-flex">
                                                    <div class="bsr">{{ custom_hgvs.transcript }}</div>
                                                    <div class="bsr">{{ custom_hgvs.hgvs }}</div>
                                                </div>
                                            </li>
                                            {% endfor %}
                                        </ul>
                                    {% else %}
                                        <div>---</div>
                                    {% endif %}
                                {% else %}
                                    {% set best_consequences = variant.get_preferred_transcripts() %}
                                    {% if best_consequences is not none and best_consequences | length > 0 and best_consequences[0].transcript.name != '' %} <!-- name != '' for intergenic variants -->
                                        <ul class="list-group list-group-horizontal-sm list-nopad-td list-nobackground">
                                            {% for consequence in best_consequences %}
                                            <li class="list-group-item noboarder-td">
                                                <div class="d-flex">
                                                    <div class="bsr"><a href="{{ url_for('extended_information.gene', gene_id=consequence.transcript.gene.id | int) }}">{{ consequence.transcript.gene.symbol }}</a></div>
                                                    <div class="bsr">{{consequence.transcript.name}}</div>
                                                    <div class="bsr">{{consequence.hgvs_c}}</div>
                                                    <div>{{consequence.hgvs_p}}</div>
                                                </div>
                                            </li>
                                            {% endfor %}
                                        </ul>
                                    {% else %}
                                        ---
                                    {% endif %}
                                {% endif %}
                            </td>
                        </tr>

                        {% if variant.variant_type == 'sv' %}
                        <tr>
                            <td class="li-label"><abbr title="All genes which overlap the variant. Purple are breakpoint genes, bold are task-force genes.">Gene(s)</abbr></td>
                            <td>
                                <ul class="list-group list-group-horizontal-sm list-nopad-td list-nobackground" >
                                    {% set breakpoint_genes = variant.get_breakpoint_genes(how = 'string') %}
                                    {% set preferred_genes = variant.get_genes(how='preferred') %}
                                    {% for overlapping_gene in variant.overlapping_genes %}
                                        <li class="list-group-item noboarder-td" >
                                            {% set current_symbol = overlapping_gene[1] %}
                                            <div class="{% if current_symbol in preferred_genes %}bold{% endif %} {% if current_symbol in breakpoint_genes%}stylish_purple{% endif %} nowrap">{{ current_symbol }}</div>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </td>
                        </tr>
                        {% endif %}

                        <!-- External Links / Further Information on external websites-->
                        <tr>
                            <td class="li-label">External resources</td>
                            <td class="vertical_align_middle">
                                <ul class="list-group list-group-horizontal-sm list-nopad-td list-nobackground" >
                                    <li class="list-group-item noboarder-td" >
                                        {{ external_link("UCSC", "https://genome.ucsc.edu/cgi-bin/hgTracks?db=hg38&position=chr2%3A" + variant.pos|string) }}
                                    </li>
                                    <li class="list-group-item noboarder-td">
                                        {{ external_link("gnomAD v3", "https://gnomad.broadinstitute.org/variant/" + variant.chrom[3:]|string + "-" + variant.pos|string + "-" + variant.ref|string + "-" + variant.alt|string + "?dataset=gnomad_r3") }}
                                    </li>
                                    <li class="list-group-item noboarder-td">
                                        {{ external_link("gnomAD v4", "https://gnomad.broadinstitute.org/variant/" + variant.chrom[3:]|string + "-" + variant.pos|string + "-" + variant.ref|string + "-" + variant.alt|string + "?dataset=gnomad_r4") }}
                                    </li>
                                    <li class="list-group-item noboarder-td">
                                        {{ external_link("VarSome", "https://varsome.com/security-validation/?next=/variant/hg38/" + variant.chrom[3:]|string + ":" + variant.pos|string + ":" + variant.ref|string + ":" + variant.alt|string) }}
                                    </li>
                                    {% set rsids = variant.get_external_ids('rsid') %}
                                    {% if rsids | length > 0 %}
                                    {% for rsid in rsids %}
                                    <li class="list-group-item noboarder-td" annotation_id="{{rsid.value}}">
                                        {{ external_link("dbSNP", "https://www.ncbi.nlm.nih.gov/snp/rs" + rsid.value|string) }}
                                    </li>
                                    {% endfor %}
                                    {% endif %}
                                    {% if variant.clinvar is not none %}
                                    <li class="list-group-item noboarder-td">
                                        {{ external_link("ClinVar", "https://www.ncbi.nlm.nih.gov/clinvar/variation/" + variant.clinvar.variation_id|string) }}
                                    </li>
                                    {% endif %}
                                    {% if variant.consequences is not none %}
                                        {% for consequence in variant.consequences %}
                                            {% if consequence.transcript.name == ENST00000269305 %} <!-- This transcript is the recommended one for TP53 (see https://www.ensembl.org/Homo_sapiens/Gene/Summary?db=core;g=ENSG00000141510;r=17:7661779-7687538) and encodes the alpha isoform for this gene -->
                                            <li class="list-group-item noboarder-td">
                                                {{ external_link("PHANTM", "https://mutantp53.broadinstitute.org/mutantp53grade/?query=" + consequence.hgvs_p|string) }}
                                            </li>
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                    {% set cosmic_ids = variant.get_external_ids('cosmic') %}
                                    {% for cosmic_id in cosmic_ids %}
                                        <li class="list-group-item noboarder-td">
                                            {{ external_link("COSMIC", "https://cancer.sanger.ac.uk/cosmic/search?q=" + cosmic_id.value|string) }}
                                        </li>
                                    {% endfor %}
                                </ul>
                            </td>
                        </tr>
                        
                    </tbody>
                </table>
            </div>
           
        </div>
    </div>
</div>
{% endmacro %}





{% macro selected_literature_display(selected_literature) %}
{% if selected_literature is not none %}
<div class="d-flex flex-wrap">
    {% for paper in selected_literature %}
    {% set tooltip = "Text passage of interest: " + paper.text_passage %}
    <div class="ssr tooltip-lg" data-bs-toggle="tooltip" title="{{tooltip}}" data-bs-placement="top">
        {% set pmid = paper.pmid %}
        {{ external_link(pmid|string, "https://pubmed.ncbi.nlm.nih.gov/" + pmid | string) }}
    </div>
    {% endfor %}
</div>
{% endif %}
{% endmacro %}


{% macro external_link(display_text, url) %}
    {% if display_text == "" or display_text is none or display_text == "nan" or display_text == "missing" %}
        <div>missing</div>
    {% else %}
        {% set words = display_text.split(' ') %}
        {% set first_words = ' '.join(words[0:-1]) %}
        {% set last_word = words[-1] %}
        <a class="external_link" uri="{{url}}">{{ first_words }} <nobr>{{ last_word }}&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" fill="currentColor" class="bi bi-box-arrow-up-right" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"/>
            <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"/>
        </svg></nobr>
        </a>
    {% endif %}
{% endmacro %}



{% macro google_link(display_text, rsid = none, hgvs_c = none, hgvs_p = none, gene_symbol = none, is_scholar = False) %}

{% if is_scholar %}
    {% set link = "https://scholar.google.de/scholar?q=" %}
{% else %}
    {% set link = "https://www.google.com/search?q=" %}
{% endif%}

{% if gene_symbol is not none %}
    {% set link = link + gene_symbol %}
{% endif %}

{% set stuff_for_braces = [] %}

{% if hgvs_c is not none %}
    {% set cdotcrop = hgvs_c.split('.')[-1] %}
    {% set stuff_for_braces = stuff_for_braces + ["%22" + cdotcrop|replace(">", "%3E") + "%22"] %}
    {% set stuff_for_braces = stuff_for_braces + ["%22" + cdotcrop|replace(">", "-%3E") + "%22"] %}
    {% set stuff_for_braces = stuff_for_braces + ["%22" + cdotcrop|replace(">", "--%3E") + "%22"] %}
    {% set stuff_for_braces = stuff_for_braces + ["%22" + cdotcrop|replace(">", "/") + "%22"] %}
{% endif %}

{% if hgvs_p is not none %}
    {% set pdotcrop = hgvs_p.split('.')[-1] %}
    {% set stuff_for_braces = stuff_for_braces + ["%22" + pdotcrop|replace(">", "%3E") + "%22"] %}
    {% set stuff_for_braces = 
        stuff_for_braces + ["%22" + 
            pdotcrop|lower|replace("ala", "A") |
            replace("arg", "R") |
            replace("asn", "N") |
            replace("asp", "D") |
            replace("asx", "B") |
            replace("cys", "C") |
            replace("glu", "E") |
            replace("gln", "Q") |
            replace("glx", "Z") |
            replace("gly", "G") |
            replace("his", "H") |
            replace("ile", "I") |
            replace("leu", "L") |
            replace("lys", "K") |
            replace("met", "M") |
            replace("phe", "F") |
            replace("pro", "P") |
            replace("ser", "S") |
            replace("thr", "T") |
            replace("trp", "W") |
            replace("tyr", "Y") |
            replace("val", "V")
        + "%22" |replace(">", "%3E")] 
    
    %}
{% endif %}

{% if rsid is not none %}
    {% set stuff_for_braces = stuff_for_braces + ["%22" + "rs" + rsid|string + "%22"] %}
{% endif %}


{% if stuff_for_braces | length > 0 %}
    {% if gene_symbol != "" %}
        {% set link = link + "+AND+(" %}
    {% endif %}
    {% set link = link + "+OR+".join(stuff_for_braces) %}
    {% set link = link + ")" %}
{% endif %}

{{ external_link( display_text, link) }}


{% endmacro %}
